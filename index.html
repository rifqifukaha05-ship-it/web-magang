<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ðŸ“š Dokumentasi Magang - Perpusnas RI</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Google Sign-In SDK -->
<script src="https://accounts.google.com/gsi/client" async defer></script>
<!-- Chart.js untuk grafik -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Firebase SDK untuk sinkronisasi data -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
<style>
/* Font Import */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

/* Global Styles */
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body { 
font-family: 'Inter', sans-serif; 
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
overflow-x: hidden;
color: #333;
}

/* Animations */
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes fadeInUp { 
from { 
opacity: 0; 
transform: translateY(30px); 
} 
to { 
opacity: 1; 
transform: translateY(0); 
} 
}
@keyframes slideInRight { 
from { 
opacity: 0; 
transform: translateX(50px); 
} 
to { 
opacity: 1; 
transform: translateX(0); 
} 
}
@keyframes pulse { 
0%, 100% { transform: scale(1); } 
50% { transform: scale(1.05); } 
}
@keyframes float {
0%, 100% { transform: translateY(0px); }
50% { transform: translateY(-10px); }
}

.animate-fadeIn { animation: fadeIn 0.5s ease-out; }
.animate-fadeInUp { animation: fadeInUp 0.6s ease-out; }
.animate-slideInRight { animation: slideInRight 0.5s ease-out; }
.animate-pulse-slow { animation: pulse 2s infinite; }
.animate-float { animation: float 3s ease-in-out infinite; }

/* Custom Components */
.glass-card {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
border-radius: 20px;
box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
border: 1px solid rgba(255, 255, 255, 0.18);
transition: all 0.3s ease;
}

.glass-card:hover {
transform: translateY(-5px);
box-shadow: 0 12px 40px rgba(31, 38, 135, 0.2);
}

.gradient-primary {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.gradient-success {
background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
}

.gradient-info {
background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
}

.gradient-warning {
background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
}

.gradient-danger {
background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
}

.gradient-secondary {
background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
}

/* Buttons */
.btn {
display: inline-flex;
align-items: center;
justify-content: center;
gap: 8px;
padding: 12px 24px;
border-radius: 12px;
font-weight: 600;
font-size: 16px;
transition: all 0.3s ease;
cursor: pointer;
border: none;
position: relative;
overflow: hidden;
}

.btn::before {
content: '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
transition: left 0.5s;
}

.btn:hover::before {
left: 100%;
}

.btn:hover {
transform: translateY(-2px);
box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}

.btn-primary {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
}

.btn-success {
background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
color: white;
}

.btn-danger {
background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
color: white;
}

.btn-secondary {
background: #f3f4f6;
color: #374151;
}

.btn-secondary:hover {
background: #e5e7eb;
}

.btn-info {
background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
color: white;
}

.btn-sm {
padding: 8px 16px;
font-size: 14px;
}

/* Form Elements */
.form-input {
width: 100%;
padding: 12px 16px;
border: 2px solid #e5e7eb;
border-radius: 12px;
font-size: 16px;
transition: all 0.3s ease;
background: white;
}

.form-input:focus {
outline: none;
border-color: #667eea;
box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.form-label {
display: block;
margin-bottom: 8px;
font-weight: 600;
color: #374151;
}

/* Notification */
.notification {
position: fixed;
top: 20px;
right: 20px;
padding: 16px 24px;
border-radius: 12px;
color: white;
font-weight: 600;
box-shadow: 0 10px 25px rgba(0,0,0,0.1);
z-index: 9999;
display: flex;
align-items: center;
gap: 12px;
transform: translateX(400px);
transition: transform 0.3s ease;
}

.notification.show {
transform: translateX(0);
}

.notification.success {
background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
}

.notification.error {
background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
}

.notification.info {
background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
}

/* Profile Photo */
.profile-photo {
width: 120px;
height: 120px;
border-radius: 50%;
object-fit: cover;
border: 4px solid white;
box-shadow: 0 4px 12px rgba(0,0,0,0.1);
transition: transform 0.3s ease;
cursor: pointer;
}

.profile-photo:hover {
transform: scale(1.05);
}

.profile-photo-placeholder {
width: 120px;
height: 120px;
border-radius: 50%;
background: #f3f4f6;
display: flex;
align-items: center;
justify-content: center;
border: 4px solid white;
box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

/* Cards */
.menu-card {
background: white;
border-radius: 20px;
padding: 24px;
box-shadow: 0 4px 20px rgba(0,0,0,0.08);
transition: all 0.3s ease;
border: 1px solid rgba(0,0,0,0.05);
cursor: pointer;
}

.menu-card:hover {
transform: translateY(-5px);
box-shadow: 0 12px 30px rgba(0,0,0,0.12);
}

/* Tables */
.custom-table {
width: 100%;
border-collapse: separate;
border-spacing: 0;
background: white;
border-radius: 16px;
overflow: hidden;
box-shadow: 0 4px 20px rgba(0,0,0,0.05);
}

.custom-table th {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
padding: 16px;
text-align: left;
font-weight: 600;
}

.custom-table td {
padding: 16px;
border-bottom: 1px solid #f3f4f6;
}

.custom-table tr:last-child td {
border-bottom: none;
}

.custom-table tr:hover {
background: #f9fafb;
}

/* Screenshot Preview */
.screenshot-preview {
max-width: 150px;
max-height: 150px;
object-fit: cover;
border-radius: 12px;
cursor: pointer;
transition: transform 0.3s ease;
}

.screenshot-preview:hover {
transform: scale(1.05);
}

.screenshot-preview-container {
display: flex;
gap: 16px;
flex-wrap: wrap;
margin-top: 16px;
justify-content: center;
}

.screenshot-item {
position: relative;
border-radius: 12px;
overflow: hidden;
box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.screenshot-actions {
position: absolute;
top: 8px;
right: 8px;
display: flex;
gap: 8px;
}

.screenshot-btn {
width: 32px;
height: 32px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: all 0.3s ease;
border: none;
}

.screenshot-btn.view {
background: rgba(34, 197, 94, 0.9);
color: white;
}

.screenshot-btn.delete {
background: rgba(239, 68, 68, 0.9);
color: white;
}

.screenshot-btn:hover {
transform: scale(1.1);
}

/* Modal */
.modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0,0,0,0.8);
display: flex;
align-items: center;
justify-content: center;
z-index: 1000;
opacity: 0;
visibility: hidden;
transition: all 0.3s ease;
}

.modal.active {
opacity: 1;
visibility: visible;
}

.modal-content {
background: white;
border-radius: 20px;
padding: 32px;
max-width: 90%;
max-height: 90%;
overflow-y: auto;
transform: scale(0.8);
transition: transform 0.3s ease;
position: relative;
}

.modal.active .modal-content {
transform: scale(1);
}

.modal-close {
position: absolute;
top: 16px;
right: 16px;
width: 40px;
height: 40px;
border-radius: 50%;
background: #f3f4f6;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: all 0.3s ease;
}

.modal-close:hover {
background: #e5e7eb;
transform: rotate(90deg);
}

/* Status Badge */
.status-badge {
display: inline-block;
padding: 6px 12px;
border-radius: 20px;
font-size: 12px;
font-weight: 600;
text-transform: uppercase;
}

.status-badge.success {
background: #dcfce7;
color: #166534;
}

.status-badge.pending {
background: #fef3c7;
color: #92400e;
}

.status-badge.warning {
background: #fed7aa;
color: #9a3412;
}

.status-badge.info {
background: #dbeafe;
color: #1e40af;
}

/* Loading Spinner */
.spinner {
width: 40px;
height: 40px;
border: 4px solid #f3f4f6;
border-top: 4px solid #667eea;
border-radius: 50%;
animation: spin 1s linear infinite;
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

/* Screenshot History Card */
.screenshot-history-card {
background: white;
border-radius: 16px;
overflow: hidden;
box-shadow: 0 4px 20px rgba(0,0,0,0.08);
transition: all 0.3s ease;
margin-bottom: 20px;
}

.screenshot-history-card:hover {
transform: translateY(-5px);
box-shadow: 0 12px 30px rgba(0,0,0,0.12);
}

.screenshot-history-header {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
padding: 16px;
display: flex;
justify-content: space-between;
align-items: center;
}

.screenshot-history-body {
padding: 20px;
}

.screenshot-history-images {
display: flex;
gap: 16px;
margin-top: 16px;
}

.screenshot-history-image {
width: 100%;
height: 250px;
object-fit: cover;
border-radius: 12px;
cursor: pointer;
transition: transform 0.3s ease;
box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.screenshot-history-image:hover {
transform: scale(1.02);
}

.screenshot-history-image-container {
position: relative;
flex: 1;
overflow: hidden;
border-radius: 12px;
}

.screenshot-history-image-overlay {
position: absolute;
bottom: 0;
left: 0;
right: 0;
background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
color: white;
padding: 12px;
display: flex;
justify-content: space-between;
align-items: center;
}

.screenshot-history-image-title {
font-weight: 600;
font-size: 14px;
}

.screenshot-history-image-actions {
display: flex;
gap: 8px;
}

.screenshot-history-image-btn {
width: 32px;
height: 32px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: all 0.3s ease;
border: none;
background: rgba(255,255,255,0.2);
color: white;
}

.screenshot-history-image-btn:hover {
background: rgba(255,255,255,0.3);
transform: scale(1.1);
}

/* Lightbox */
.lightbox {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0,0,0,0.9);
display: flex;
align-items: center;
justify-content: center;
z-index: 2000;
opacity: 0;
visibility: hidden;
transition: all 0.3s ease;
}

.lightbox.active {
opacity: 1;
visibility: visible;
}

.lightbox-content {
position: relative;
max-width: 90%;
max-height: 90%;
display: flex;
flex-direction: column;
align-items: center;
}

.lightbox-image {
max-width: 100%;
max-height: 80vh;
object-fit: contain;
border-radius: 8px;
box-shadow: 0 4px 30px rgba(0,0,0,0.5);
}

.lightbox-caption {
color: white;
margin-top: 16px;
text-align: center;
font-size: 16px;
}

.lightbox-close {
position: absolute;
top: -40px;
right: 0;
width: 40px;
height: 40px;
border-radius: 50%;
background: rgba(255,255,255,0.2);
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: all 0.3s ease;
color: white;
}

.lightbox-close:hover {
background: rgba(255,255,255,0.3);
transform: rotate(90deg);
}

.lightbox-nav {
position: absolute;
top: 50%;
transform: translateY(-50%);
width: 50px;
height: 50px;
border-radius: 50%;
background: rgba(255,255,255,0.2);
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: all 0.3s ease;
color: white;
}

.lightbox-nav:hover {
background: rgba(255,255,255,0.3);
}

.lightbox-prev {
left: -70px;
}

.lightbox-next {
right: -70px;
}

/* Monitoring Network Styles */
.network-card {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
border-radius: 20px;
box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
border: 1px solid rgba(255, 255, 255, 0.18);
overflow: hidden;
}

.network-header {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
padding: 20px;
text-align: center;
color: white;
}

.network-header h1 {
font-weight: bold;
margin: 0;
font-size: 2rem;
}

.network-content {
padding: 30px;
}

.network-form {
display: flex;
flex-direction: column;
gap: 20px;
}

.network-form-group {
display: flex;
align-items: center;
justify-content: space-between;
background: rgba(255, 255, 255, 0.7);
padding: 15px;
border-radius: 12px;
transition: all 0.3s ease;
}

.network-form-group:hover {
background: rgba(255, 255, 255, 0.9);
transform: translateY(-2px);
box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.network-form-label {
font-weight: 600;
color: #4d009d;
width: 60%;
}

.network-form-input {
width: 35%;
padding: 8px 12px;
border: 2px solid #e5e7eb;
border-radius: 8px;
background: white;
}

.network-form-input:focus {
outline: none;
border-color: #667eea;
box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.network-actions {
display: flex;
justify-content: center;
gap: 20px;
margin-top: 30px;
}

.network-btn {
padding: 12px 24px;
border-radius: 12px;
font-weight: 600;
transition: all 0.3s ease;
cursor: pointer;
border: none;
}

.network-btn-primary {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
}

.network-btn-primary:hover {
transform: translateY(-2px);
box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}

.network-btn-secondary {
background: #f3f4f6;
color: #374151;
}

.network-btn-secondary:hover {
background: #e5e7eb;
}

.network-btn-danger {
background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
color: white;
}

.network-btn-danger:hover {
transform: translateY(-2px);
box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}

.network-history {
margin-top: 30px;
overflow-x: auto;
}

.network-table {
width: 100%;
border-collapse: separate;
border-spacing: 0;
background: white;
border-radius: 16px;
overflow: hidden;
box-shadow: 0 4px 20px rgba(0,0,0,0.05);
}

.network-table th {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
padding: 16px;
text-align: left;
font-weight: 600;
}

.network-table td {
padding: 16px;
border-bottom: 1px solid #f3f4f6;
}

.network-table tr:last-child td {
border-bottom: none;
}

.network-table tr:hover {
background: #f9fafb;
}

.preview-img {
width: 60px;
height: 60px;
object-fit: cover;
border-radius: 10px;
cursor: pointer;
transition: transform 0.2s;
}

.preview-img:hover {
transform: scale(1.2);
}

/* Guru Dashboard Styles */
.guru-stats-card {
background: white;
border-radius: 16px;
padding: 24px;
box-shadow: 0 4px 20px rgba(0,0,0,0.08);
transition: all 0.3s ease;
}

.guru-stats-card:hover {
transform: translateY(-5px);
box-shadow: 0 12px 30px rgba(0,0,0,0.12);
}

.progress-bar {
width: 100%;
height: 8px;
background: #e5e7eb;
border-radius: 4px;
overflow: hidden;
}

.progress-fill {
height: 100%;
background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
transition: width 0.3s ease;
}

.student-card {
background: white;
border-radius: 16px;
padding: 20px;
box-shadow: 0 4px 20px rgba(0,0,0,0.08);
transition: all 0.3s ease;
margin-bottom: 16px;
}

.student-card:hover {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(0,0,0,0.12);
}

.task-item {
background: #f9fafb;
border-radius: 12px;
padding: 12px;
margin-bottom: 8px;
display: flex;
justify-content: space-between;
align-items: center;
transition: all 0.3s ease;
}

.task-item:hover {
background: #f3f4f6;
}

.task-status {
display: inline-flex;
align-items: center;
gap: 4px;
padding: 4px 8px;
border-radius: 8px;
font-size: 12px;
font-weight: 600;
}

.task-status.completed {
background: #dcfce7;
color: #166534;
}

.task-status.pending {
background: #fef3c7;
color: #92400e;
}

/* Task Management Styles */
.task-card {
background: white;
border-radius: 16px;
padding: 20px;
box-shadow: 0 4px 20px rgba(0,0,0,0.08);
transition: all 0.3s ease;
margin-bottom: 16px;
border-left: 4px solid #667eea;
}

.task-card:hover {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(0,0,0,0.12);
}

.task-card.completed {
border-left-color: #22c55e;
}

.task-card.pending {
border-left-color: #f59e0b;
}

.task-card.overdue {
border-left-color: #ef4444;
}

.grade-input {
width: 80px;
padding: 8px;
border: 2px solid #e5e7eb;
border-radius: 8px;
text-align: center;
font-weight: 600;
}

.grade-input:focus {
outline: none;
border-color: #667eea;
}

.grade-badge {
display: inline-block;
padding: 4px 12px;
border-radius: 20px;
font-weight: 600;
font-size: 14px;
}

.grade-badge.excellent {
background: #dcfce7;
color: #166534;
}

.grade-badge.good {
background: #dbeafe;
color: #1e40af;
}

.grade-badge.average {
background: #fef3c7;
color: #92400e;
}

.grade-badge.poor {
background: #fee2e2;
color: #991b1b;
}

/* Task Submission Styles */
.task-submission {
background: #f9fafb;
border-radius: 12px;
padding: 16px;
margin-top: 16px;
}

.task-submission-textarea {
width: 100%;
padding: 12px;
border: 2px solid #e5e7eb;
border-radius: 8px;
min-height: 100px;
resize: vertical;
}

.task-submission-textarea:focus {
outline: none;
border-color: #667eea;
box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.task-submission-files {
margin-top: 12px;
}

.task-submission-file-item {
display: flex;
align-items: center;
justify-content: space-between;
background: white;
padding: 8px 12px;
border-radius: 8px;
margin-bottom: 8px;
}

.task-submission-file-name {
font-size: 14px;
color: #374151;
}

.task-submission-file-remove {
color: #ef4444;
cursor: pointer;
}

/* Floating Action Button */
.fab {
position: fixed;
bottom: 20px;
right: 20px;
width: 60px;
height: 60px;
border-radius: 50%;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
display: flex;
align-items: center;
justify-content: center;
box-shadow: 0 4px 12px rgba(0,0,0,0.15);
cursor: pointer;
transition: all 0.3s ease;
z-index: 100;
}

.fab:hover {
transform: scale(1.1);
box-shadow: 0 6px 20px rgba(0,0,0,0.2);
}

/* Task Completion Styles */
.task-completion-section {
background: #f9fafb;
border-radius: 12px;
padding: 16px;
margin-top: 16px;
}

.task-completion-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 12px;
}

.task-completion-title {
font-weight: 600;
color: #374151;
}

.task-completion-status {
display: inline-flex;
align-items: center;
gap: 4px;
padding: 4px 8px;
border-radius: 8px;
font-size: 12px;
font-weight: 600;
}

.task-completion-status.completed {
background: #dcfce7;
color: #166534;
}

.task-completion-status.pending {
background: #fef3c7;
color: #92400e;
}

.task-completion-date {
font-size: 12px;
color: #6b7280;
margin-top: 4px;
}

.task-completion-actions {
display: flex;
gap: 8px;
margin-top: 12px;
}

/* Google Sign-In Styles */
.google-btn {
display: flex;
align-items: center;
justify-content: center;
gap: 12px;
width: 100%;
padding: 12px 16px;
border: 2px solid #e5e7eb;
border-radius: 12px;
background: white;
color: #374151;
font-weight: 600;
font-size: 16px;
transition: all 0.3s ease;
cursor: pointer;
}

.google-btn:hover {
background: #f9fafb;
border-color: #d1d5db;
transform: translateY(-1px);
box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.divider {
position: relative;
text-align: center;
margin: 24px 0;
}

.divider::before {
content: '';
position: absolute;
top: 50%;
left: 0;
right: 0;
height: 1px;
background: #e5e7eb;
}

.divider span {
background: white;
padding: 0 16px;
color: #6b7280;
font-size: 14px;
position: relative;
}

/* Export Menu */
.export-menu {
position: relative;
display: inline-block;
}

.export-dropdown {
display: none;
position: absolute;
background-color: white;
min-width: 160px;
box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
z-index: 1;
border-radius: 8px;
overflow: hidden;
}

.export-dropdown a {
color: black;
padding: 12px 16px;
text-decoration: none;
display: block;
transition: all 0.3s ease;
}

.export-dropdown a:hover {
background-color: #f1f1f1;
}

.export-menu:hover .export-dropdown {
display: block;
}

/* Notification Panel */
.notification-panel {
position: fixed;
top: 70px;
right: 20px;
width: 350px;
max-height: 400px;
background: white;
border-radius: 12px;
box-shadow: 0 10px 25px rgba(0,0,0,0.1);
z-index: 1000;
overflow-y: auto;
display: none;
}

.notification-panel.active {
display: block;
}

.notification-item {
padding: 12px 16px;
border-bottom: 1px solid #f3f4f6;
transition: all 0.3s ease;
}

.notification-item:hover {
background: #f9fafb;
}

.notification-item.unread {
background: #eff6ff;
border-left: 4px solid #3b82f6;
}

.notification-title {
font-weight: 600;
margin-bottom: 4px;
}

.notification-message {
font-size: 14px;
color: #6b7280;
margin-bottom: 4px;
}

.notification-time {
font-size: 12px;
color: #9ca3af;
}

.notification-badge {
position: absolute;
top: -8px;
right: -8px;
background: #ef4444;
color: white;
border-radius: 50%;
width: 20px;
height: 20px;
display: flex;
align-items: center;
justify-content: center;
font-size: 12px;
font-weight: 600;
}

/* Filter Chips */
.filter-chips {
display: flex;
flex-wrap: wrap;
gap: 8px;
margin-bottom: 16px;
}

.filter-chip {
padding: 6px 12px;
border-radius: 20px;
font-size: 14px;
font-weight: 500;
cursor: pointer;
transition: all 0.3s ease;
background: #f3f4f6;
color: #374151;
}

.filter-chip.active {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
}

.filter-chip:hover {
transform: translateY(-2px);
}

.task-progress {
width: 100%;
height: 8px;
background: #e5e7eb;
border-radius: 4px;
overflow: hidden;
margin-top: 8px;
}

.task-progress-fill {
height: 100%;
background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
transition: width 0.3s ease;
}

.feedback-form {
background: #f9fafb;
border-radius: 12px;
padding: 16px;
margin-top: 16px;
}

.feedback-textarea {
width: 100%;
padding: 12px;
border: 2px solid #e5e7eb;
border-radius: 8px;
min-height: 100px;
resize: vertical;
margin-bottom: 12px;
}

.feedback-textarea:focus {
outline: none;
border-color: #667eea;
box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

/* Interactive Elements */
.interactive-card {
background: white;
border-radius: 16px;
padding: 20px;
box-shadow: 0 4px 20px rgba(0,0,0,0.08);
transition: all 0.3s ease;
margin-bottom: 16px;
cursor: pointer;
position: relative;
overflow: hidden;
}

.interactive-card::before {
content: '';
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
opacity: 0;
transition: opacity 0.3s ease;
}

.interactive-card:hover::before {
opacity: 1;
}

.interactive-card:hover {
transform: translateY(-5px);
box-shadow: 0 12px 30px rgba(0,0,0,0.12);
}

.interactive-card-content {
position: relative;
z-index: 1;
}

.chart-container {
position: relative;
height: 300px;
width: 100%;
}

.activity-timeline {
position: relative;
margin: 20px 0;
}

.activity-timeline::before {
content: '';
position: absolute;
top: 0;
left: 20px;
height: 100%;
width: 2px;
background: #e5e7eb;
}

.timeline-item {
position: relative;
padding-left: 50px;
margin-bottom: 20px;
}

.timeline-item::before {
content: '';
position: absolute;
top: 5px;
left: 14px;
width: 12px;
height: 12px;
border-radius: 50%;
background: #667eea;
}

.timeline-content {
background: #f9fafb;
border-radius: 8px;
padding: 12px;
}

.timeline-title {
font-weight: 600;
margin-bottom: 4px;
}

.timeline-date {
font-size: 12px;
color: #6b7280;
}

/* Sync Status Indicator */
.sync-status {
position: fixed;
bottom: 20px;
left: 20px;
display: flex;
align-items: center;
gap: 8px;
padding: 8px 12px;
background: rgba(255, 255, 255, 0.9);
border-radius: 20px;
font-size: 12px;
font-weight: 600;
box-shadow: 0 4px 12px rgba(0,0,0,0.1);
z-index: 100;
}

.sync-status.connected {
color: #22c55e;
}

.sync-status.connecting {
color: #f59e0b;
}

.sync-status.disconnected {
color: #ef4444;
}

.sync-status i {
animation: spin 2s linear infinite;
}

.sync-status.connected i {
animation: none;
}

/* Responsive */
@media (max-width: 768px) {
.btn {
padding: 10px 16px;
font-size: 14px;
}

.menu-card {
padding: 16px;
}

.custom-table {
font-size: 14px;
}

.custom-table th,
.custom-table td {
padding: 12px 8px;
}

.screenshot-history-images {
flex-direction: column;
}

.screenshot-history-image {
width: 100%;
height: auto;
}

.lightbox-nav {
width: 40px;
height: 40px;
}

.lightbox-prev {
left: 10px;
}

.lightbox-next {
right: 10px;
}

.network-form-group {
flex-direction: column;
align-items: flex-start;
gap: 10px;
}

.network-form-label {
width: 100%;
}

.network-form-input {
width: 100%;
}

.network-actions {
flex-direction: column;
gap: 10px;
}

.notification-panel {
width: 90%;
right: 5%;
}
}
</style>
</head>
<body>

<!-- Sync Status Indicator -->
<div id="syncStatus" class="sync-status disconnected">
<i class="fas fa-sync-alt"></i>
<span id="syncStatusText">Tidak Terhubung</span>
</div>

<!-- Notification -->
<div id="notification" class="notification">
<i class="fas fa-check-circle"></i>
<span id="notificationText">Success!</span>
</div>

<!-- Notification Panel -->
<div id="notificationPanel" class="notification-panel">
<div class="p-4 border-b border-gray-200 flex justify-between items-center">
  <h3 class="font-semibold text-gray-800">Notifikasi</h3>
  <button onclick="clearAllNotifications()" class="text-sm text-blue-600 hover:text-blue-800">Hapus Semua</button>
</div>
<div id="notificationList" class="max-h-80 overflow-y-auto">
  <!-- Notifications will be loaded here -->
</div>
</div>

<!-- Image Modal -->
<div id="imageModal" class="modal" onclick="closeImageModal()">
<div class="modal-content" onclick="event.stopPropagation()">
<button class="modal-close" onclick="closeImageModal()">
<i class="fas fa-times"></i>
</button>
<img id="modalImage" style="width: 100%; height: auto; border-radius: 12px;" src="" alt="Preview">
</div>
</div>

<!-- Task Modal -->
<div id="taskModal" class="modal" onclick="closeTaskModal()">
<div class="modal-content" onclick="event.stopPropagation()">
<button class="modal-close" onclick="closeTaskModal()">
<i class="fas fa-times"></i>
</button>
<h2 class="text-2xl font-bold text-gray-800 mb-6" id="taskModalTitle">Tambah Tugas</h2>
<form id="taskForm" class="space-y-4" onsubmit="return false;">
<div>
<label class="form-label">Judul Tugas</label>
<input type="text" id="taskTitle" class="form-input" placeholder="Masukkan judul tugas" required>
</div>
<div>
<label class="form-label">Deskripsi Tugas</label>
<textarea id="taskDescription" rows="4" class="form-input" placeholder="Masukkan deskripsi tugas" required></textarea>
</div>
<div>
<label class="form-label">Deadline</label>
<input type="date" id="taskDeadline" class="form-input" required>
</div>
<div>
<label class="form-label">Poin Maksimal</label>
<input type="number" id="taskMaxPoints" class="form-input" placeholder="100" value="100" min="1" max="100" required>
</div>
<div>
<label class="form-label">Tugas Untuk</label>
<select id="taskAssignTo" class="form-input" required>
<option value="">Pilih Siswa</option>
</select>
</div>
<div class="flex justify-end gap-4">
<button type="button" onclick="closeTaskModal()" class="btn btn-secondary">
Batal
</button>
<button type="button" onclick="saveTask()" class="btn btn-primary">
<i class="fas fa-save"></i>
Simpan Tugas
</button>
</div>
</form>
</div>
</div>

<!-- Task Detail Modal -->
<div id="taskDetailModal" class="modal" onclick="closeTaskDetailModal()">
<div class="modal-content" onclick="event.stopPropagation()">
<button class="modal-close" onclick="closeTaskDetailModal()">
<i class="fas fa-times"></i>
</button>
<h2 class="text-2xl font-bold text-gray-800 mb-6">Detail Tugas</h2>
<div id="taskDetailContent">
<!-- Task details will be loaded here -->
</div>
</div>
</div>

<!-- Feedback Modal -->
<div id="feedbackModal" class="modal" onclick="closeFeedbackModal()">
<div class="modal-content" onclick="event.stopPropagation()">
<button class="modal-close" onclick="closeFeedbackModal()">
<i class="fas fa-times"></i>
</button>
<h2 class="text-2xl font-bold text-gray-800 mb-6">Kirim Feedback</h2>
<div class="mb-4">
<p class="text-gray-600">Kirim feedback kepada: <strong id="feedbackStudentName">-</strong></p>
</div>
<form id="feedbackForm" class="space-y-4" onsubmit="return false;">
<div>
<label class="form-label">Judul Feedback</label>
<input type="text" id="feedbackTitle" class="form-input" placeholder="Masukkan judul feedback" required>
</div>
<div>
<label class="form-label">Pesan Feedback</label>
<textarea id="feedbackMessage" rows="4" class="form-input" placeholder="Masukkan pesan feedback" required></textarea>
</div>
<div>
<label class="form-label">Tipe Feedback</label>
<select id="feedbackType" class="form-input" required>
<option value="info">Informasi</option>
<option value="success">Pujian</option>
<option value="warning">Peringatan</option>
<option value="error">Koreksi</option>
</select>
</div>
<div class="flex justify-end gap-4">
<button type="button" onclick="closeFeedbackModal()" class="btn btn-secondary">
Batal
</button>
<button type="button" onclick="submitFeedback()" class="btn btn-primary">
<i class="fas fa-paper-plane"></i>
Kirim Feedback
</button>
</div>
</form>
</div>
</div>

<!-- Lightbox untuk melihat gambar -->
<div id="lightbox" class="lightbox" onclick="closeLightbox()">
<div class="lightbox-content" onclick="event.stopPropagation()">
<button class="lightbox-close" onclick="closeLightbox()">
<i class="fas fa-times"></i>
</button>
<button class="lightbox-nav lightbox-prev" onclick="navigateLightbox(-1)">
<i class="fas fa-chevron-left"></i>
</button>
<button class="lightbox-nav lightbox-next" onclick="navigateLightbox(1)">
<i class="fas fa-chevron-right"></i>
</button>
<img id="lightboxImage" class="lightbox-image" src="" alt="Screenshot">
<div id="lightboxCaption" class="lightbox-caption"></div>
</div>
</div>

<!-- ðŸŒŸ HALAMAN 1: LANDING -->
<section id="page1" class="min-h-screen flex flex-col justify-center items-center text-center px-6 animate-fadeIn">
<div class="animate-fadeInUp" style="animation-delay: 0.2s;">
<div class="w-32 h-32 bg-white rounded-full p-3 shadow-xl mb-8 animate-float">
<img src="https://picsum.photos/seed/perpusnas-logo/200/200.jpg" alt="Logo" class="w-full h-full object-contain rounded-full">
</div>
<h1 class="text-5xl md:text-6xl font-bold text-white mb-4">DOKUMENTASI MAGANG</h1>
<p class="text-xl md:text-2xl text-white/90 mb-12">Perpustakaan Nasional Republik Indonesia</p>
<div class="flex flex-col md:flex-row gap-4 justify-center">
<button onclick="goToLogin()" class="btn btn-success text-lg px-8 py-4">
<i class="fas fa-user-graduate"></i>
LOGIN SISWA
</button>
<button onclick="goToGuruLogin()" class="btn btn-info text-lg px-8 py-4">
<i class="fas fa-chalkboard-teacher"></i>
LOGIN GURU
</button>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN 2: LOGIN SISWA -->
<section id="pageLogin" class="hidden min-h-screen flex items-center justify-center px-6">
<div class="glass-card w-full max-w-md p-8 animate-fadeInUp">
<div class="text-center mb-8">
<div class="w-20 h-20 bg-gradient-primary rounded-full p-3 mx-auto mb-4">
<i class="fas fa-user text-white text-3xl flex items-center justify-center h-full"></i>
</div>
<h2 class="text-3xl font-bold text-gray-800">LOGIN SISWA</h2>
<p class="text-gray-600 mt-2">Masuk ke akun Anda</p>
</div>

<!-- Google Sign-In Button -->
<div class="mb-6">
<div id="google-signin-button" class="flex justify-center my-4"></div>
<button onclick="initializeGoogleSignIn()" class="google-btn">
<svg class="w-5 h-5" viewBox="0 0 24 24">
<path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
<path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
<path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
<path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
</svg>
Masuk dengan Google
</button>
</div>

<!-- Demo Account Button -->
<div class="mb-4">
<button onclick="useDemoAccount()" class="btn btn-info w-full text-sm">
<i class="fas fa-flask mr-2"></i>
Gunakan Akun Demo (untuk testing)
</button>
</div>

<!-- Divider -->
<div class="divider">
<span>atau masuk dengan email</span>
</div>

<!-- Email Login Form -->
<form id="loginForm" class="space-y-6" onsubmit="return false;">
<div>
<label class="form-label">Email</label>
<input type="email" id="loginEmail" class="form-input" placeholder="nama@email.com">
</div>
<div>
<label class="form-label">Password</label>
<input type="password" id="loginPassword" class="form-input" placeholder="Masukkan password">
</div>
<button type="button" onclick="loginWithEmail()" class="btn btn-primary w-full">
<i class="fas fa-sign-in-alt"></i>
LOGIN
</button>
</form>

<div class="text-center mt-6">
<p class="text-gray-600">Belum punya akun? 
<a href="#" onclick="goToRegister()" class="text-primary font-semibold hover:underline">Registrasi</a>
</p>
<p class="text-gray-600 mt-2">
<a href="#" onclick="goToGuruLogin()" class="text-info font-semibold hover:underline">Login sebagai Guru</a>
</p>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN LOGIN GURU -->
<section id="pageGuruLogin" class="hidden min-h-screen flex items-center justify-center px-6">
<div class="glass-card w-full max-w-md p-8 animate-fadeInUp">
<div class="text-center mb-8">
<div class="w-20 h-20 bg-gradient-info rounded-full p-3 mx-auto mb-4">
<i class="fas fa-chalkboard-teacher text-white text-3xl flex items-center justify-center h-full"></i>
</div>
<h2 class="text-3xl font-bold text-gray-800">LOGIN GURU</h2>
<p class="text-gray-600 mt-2">Masuk sebagai Pembimbing</p>
</div>

<form id="guruLoginForm" class="space-y-6" onsubmit="return false;">
<div>
<label class="form-label">Username</label>
<input type="text" id="guruUsername" class="form-input" placeholder="Masukkan username">
</div>
<div>
<label class="form-label">Password</label>
<input type="password" id="guruPassword" class="form-input" placeholder="Masukkan password">
</div>
<button type="button" onclick="loginGuru()" class="btn btn-info w-full">
<i class="fas fa-sign-in-alt"></i>
LOGIN GURU
</button>
</form>

<div class="text-center mt-6">
<p class="text-gray-600">
<a href="#" onclick="goToLogin()" class="text-primary font-semibold hover:underline">Login sebagai Siswa</a>
</p>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN 3: REGISTER -->
<section id="pageRegister" class="hidden min-h-screen flex items-center justify-center px-6">
<div class="glass-card w-full max-w-md p-8 animate-fadeInUp">
<div class="text-center mb-8">
<div class="w-20 h-20 bg-gradient-success rounded-full p-3 mx-auto mb-4">
<i class="fas fa-user-plus text-white text-3xl flex items-center justify-center h-full"></i>
</div>
<h2 class="text-3xl font-bold text-gray-800">REGISTRASI</h2>
<p class="text-gray-600 mt-2">Buat akun baru</p>
</div>

<!-- Google Sign-Up Button -->
<div class="mb-6">
<div id="google-signup-button" class="flex justify-center my-4"></div>
<button onclick="initializeGoogleSignUp()" class="google-btn">
<svg class="w-5 h-5" viewBox="0 0 24 24">
<path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
<path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
<path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
<path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
</svg>
Daftar dengan Google
</button>
</div>

<!-- Divider -->
<div class="divider">
<span>atau daftar dengan email</span>
</div>

<!-- Email Registration Form -->
<form id="registerForm" class="space-y-6" onsubmit="return false;">
<div>
<label class="form-label">Email</label>
<input type="email" id="regEmail" class="form-input" placeholder="nama@email.com" required>
</div>
<div>
<label class="form-label">Password</label>
<input type="password" id="regPassword" class="form-input" placeholder="Masukkan password" required>
</div>
<div>
<label class="form-label">Nama Lengkap</label>
<input type="text" id="regNama" class="form-input" placeholder="Masukkan nama lengkap" required>
</div>
<div>
<label class="form-label">Asal Sekolah</label>
<input type="text" id="regAsal" class="form-input" placeholder="Masukkan asal sekolah" required>
</div>
<div>
<label class="form-label">Tempat PKL/Magang</label>
<input type="text" id="regLokasi" class="form-input" placeholder="Masukkan tempat PKL/Magang" required>
</div>

<!-- Profile Photo Upload -->
<div class="text-center">
<label class="form-label">Foto Profil</label>
<div class="flex flex-col items-center">
<div id="regProfilePhotoPreview" class="profile-photo-placeholder">
<i class="fas fa-user text-gray-400 text-3xl"></i>
</div>
<input type="file" id="regProfilePhoto" accept="image/*" class="hidden" onchange="previewProfilePhoto(event, 'regProfilePhotoPreview')">
<label for="regProfilePhoto" class="btn btn-secondary mt-4">
<i class="fas fa-camera"></i>
Pilih Foto
</label>
</div>
</div>

<button type="button" onclick="registerWithEmail()" class="btn btn-success w-full">
<i class="fas fa-check"></i>
DAFTAR
</button>
</form>

<div class="text-center mt-6">
<p class="text-gray-600">Sudah punya akun? 
<a href="#" onclick="goToLogin()" class="text-primary font-semibold hover:underline">Login</a>
</p>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN DASHBOARD GURU -->
<section id="pageGuruDashboard" class="hidden min-h-screen p-6">
<div class="max-w-7xl mx-auto">
<!-- Header -->
<div class="glass-card p-6 mb-8 animate-fadeInUp">
<div class="flex flex-col md:flex-row items-center justify-between gap-6">
<div class="flex items-center gap-4">
<div class="w-16 h-16 bg-gradient-info rounded-full p-3">
<i class="fas fa-chalkboard-teacher text-white text-2xl flex items-center justify-center h-full"></i>
</div>
<div>
<h2 class="text-2xl font-bold text-gray-800">DASHBOARD GURU</h2>
<p class="text-gray-600">Pantau progress magang siswa</p>
</div>
</div>
<div class="flex items-center gap-4">
<span class="text-gray-600">Selamat datang, <strong id="guruName">Guru</strong></span>
<div class="relative">
<button onclick="toggleNotificationPanel()" class="btn btn-secondary btn-sm relative">
<i class="fas fa-bell"></i>
<span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
</button>
</div>
<button onclick="logoutGuru()" class="btn btn-danger btn-sm">
<i class="fas fa-sign-out-alt"></i>
Logout
</button>
</div>
</div>
</div>

<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
<div class="guru-stats-card animate-fadeInUp" style="animation-delay: 0.1s;">
<div class="flex items-center justify-between mb-4">
<div class="w-12 h-12 bg-gradient-success rounded-full p-3">
<i class="fas fa-users text-white text-sm flex items-center justify-center h-full"></i>
</div>
<span class="text-2xl font-bold text-gray-800" id="totalStudents">0</span>
</div>
<h3 class="text-lg font-semibold text-gray-800">Total Siswa</h3>
<p class="text-sm text-gray-600">Siswa magang aktif</p>
</div>

<div class="guru-stats-card animate-fadeInUp" style="animation-delay: 0.2s;">
<div class="flex items-center justify-between mb-4">
<div class="w-12 h-12 bg-gradient-primary rounded-full p-3">
<i class="fas fa-tasks text-white text-sm flex items-center justify-center h-full"></i>
</div>
<span class="text-2xl font-bold text-gray-800" id="totalTasks">0</span>
</div>
<h3 class="text-lg font-semibold text-gray-800">Total Tugas</h3>
<p class="text-sm text-gray-600">Semua tugas siswa</p>
</div>

<div class="guru-stats-card animate-fadeInUp" style="animation-delay: 0.3s;">
<div class="flex items-center justify-between mb-4">
<div class="w-12 h-12 bg-gradient-warning rounded-full p-3">
<i class="fas fa-clock text-white text-sm flex items-center justify-center h-full"></i>
</div>
<span class="text-2xl font-bold text-gray-800" id="pendingTasks">0</span>
</div>
<h3 class="text-lg font-semibold text-gray-800">Tugas Pending</h3>
<p class="text-sm text-gray-600">Menunggu review</p>
</div>

<div class="guru-stats-card animate-fadeInUp" style="animation-delay: 0.4s;">
<div class="flex items-center justify-between mb-4">
<div class="w-12 h-12 bg-gradient-info rounded-full p-3">
<i class="fas fa-chart-line text-white text-sm flex items-center justify-center h-full"></i>
</div>
<span class="text-2xl font-bold text-gray-800" id="completionRate">0%</span>
</div>
<h3 class="text-lg font-semibold text-gray-800">Completion Rate</h3>
<p class="text-sm text-gray-600">Rata-rata progress</p>
</div>
</div>

<!-- Chart Section -->
<div class="glass-card p-6 mb-8 animate-fadeInUp">
<h3 class="text-xl font-bold text-gray-800 mb-6">Grafik Progress Siswa</h3>
<div class="chart-container">
<canvas id="progressChart"></canvas>
</div>
</div>

<!-- Task Management Section -->
<div class="glass-card p-6 mb-8 animate-fadeInUp">
<div class="flex justify-between items-center mb-6">
<h3 class="text-xl font-bold text-gray-800">Manajemen Tugas</h3>
<button onclick="openTaskModal()" class="btn btn-primary">
<i class="fas fa-plus"></i>
Tambah Tugas
</button>
</div>
<div id="tasksList" class="space-y-4">
<!-- Tasks will be loaded here -->
</div>
</div>

<!-- Filter Section -->
<div class="glass-card p-6 mb-8 animate-fadeInUp">
<div class="flex flex-col md:flex-row gap-4 items-center">
<div class="flex-1">
<label class="form-label">Filter Siswa</label>
<select id="studentFilter" class="form-input" onchange="filterStudents()">
<option value="">Semua Siswa</option>
</select>
</div>
<div class="flex-1">
<label class="form-label">Filter Tugas</label>
<select id="taskFilter" class="form-input" onchange="filterTasks()">
<option value="">Semua Tugas</option>
<option value="absen">Data Hadir</option>
<option value="monitoring">Monitoring Website</option>
<option value="network">Monitoring Network</option>
<option value="rekap">Rekap Log Harian</option>
<option value="laporan">Laporan Harian</option>
</select>
</div>
<div class="flex items-end">
<button onclick="refreshData()" class="btn btn-primary">
<i class="fas fa-sync-alt"></i>
Refresh
</button>
</div>
</div>
</div>

<!-- Students List -->
<div class="glass-card p-8 animate-fadeInUp">
<h3 class="text-2xl font-bold text-gray-800 mb-6">Daftar Siswa Magang</h3>
<div id="studentsList" class="space-y-4">
<!-- Students will be loaded here -->
</div>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN DETAIL SISWA (GURU VIEW) -->
<section id="pageStudentDetail" class="hidden min-h-screen p-6">
<div class="max-w-6xl mx-auto">
<div class="glass-card p-8 animate-fadeInUp">
<!-- Student Header -->
<div class="flex flex-col md:flex-row items-center gap-6 mb-8">
<div id="studentDetailPhoto">
<div class="profile-photo-placeholder">
<i class="fas fa-user text-gray-400 text-3xl"></i>
</div>
</div>
<div class="flex-1">
<h2 class="text-3xl font-bold text-gray-800 mb-2" id="studentDetailName">Nama Siswa</h2>
<p class="text-gray-600 mb-1"><strong>Email:</strong> <span id="studentDetailEmail">-</span></p>
<p class="text-gray-600 mb-1"><strong>Sekolah:</strong> <span id="studentDetailSchool">-</span></p>
<p class="text-gray-600 mb-1"><strong>Lokasi Magang:</strong> <span id="studentDetailLocation">-</span></p>
<p class="text-gray-600"><strong>Jurusan:</strong> <span id="studentDetailJurusan">-</span></p>
</div>
<div class="text-center">
<div class="text-3xl font-bold text-primary mb-2" id="studentProgress">0%</div>
<p class="text-gray-600">Progress</p>
<div class="progress-bar mt-2">
<div class="progress-fill" id="studentProgressBar" style="width: 0%"></div>
</div>
</div>
</div>

<!-- Activity Timeline -->
<div class="mb-8">
<h3 class="text-xl font-bold text-gray-800 mb-6">Aktivitas Terkini</h3>
<div class="activity-timeline" id="activityTimeline">
<!-- Activity items will be loaded here -->
</div>
</div>

<!-- Task Categories -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
<!-- Data Hadir -->
<div class="interactive-card" onclick="viewStudentTask('absen')">
<div class="interactive-card-content">
<div class="flex items-center justify-between mb-4">
<div class="w-12 h-12 bg-gradient-success rounded-full p-3">
<i class="fas fa-calendar-check text-white text-sm flex items-center justify-center h-full"></i>
</div>
<span class="task-status completed" id="absenStatus">
<i class="fas fa-check-circle"></i>
<span id="absenCount">0</span>
</span>
</div>
<h3 class="text-lg font-semibold text-gray-800 mb-2">Data Hadir</h3>
<p class="text-sm text-gray-600 mb-4">Kehadiran harian</p>
<div class="task-progress">
<div class="task-progress-fill" id="absenProgress" style="width: 0%"></div>
</div>
</div>
</div>

<!-- Monitoring Website -->
<div class="interactive-card" onclick="viewStudentTask('monitoring')">
<div class="interactive-card-content">
<div class="flex items-center justify-between mb-4">
<div class="w-12 h-12 bg-gradient-info rounded-full p-3">
<i class="fas fa-globe text-white text-sm flex items-center justify-center h-full"></i>
</div>
<span class="task-status pending" id="monitoringStatus">
<i class="fas fa-clock"></i>
<span id="monitoringCount">0</span>
</span>
</div>
<h3 class="text-lg font-semibold text-gray-800 mb-2">Monitoring Website</h3>
<p class="text-sm text-gray-600 mb-4">Data monitoring</p>
<div class="task-progress">
<div class="task-progress-fill" id="monitoringProgress" style="width: 0%"></div>
</div>
</div>
</div>

<!-- Monitoring Network -->
<div class="interactive-card" onclick="viewStudentTask('network')">
<div class="interactive-card-content">
<div class="flex items-center justify-between mb-4">
<div class="w-12 h-12 bg-gradient-warning rounded-full p-3">
<i class="fas fa-network-wired text-white text-sm flex items-center justify-center h-full"></i>
</div>
<span class="task-status pending" id="networkStatus">
<i class="fas fa-clock"></i>
<span id="networkCount">0</span>
</span>
</div>
<h3 class="text-lg font-semibold text-gray-800 mb-2">Monitoring Network</h3>
<p class="text-sm text-gray-600 mb-4">Jaringan komputer</p>
<div class="task-progress">
<div class="task-progress-fill" id="networkProgress" style="width: 0%"></div>
</div>
</div>
</div>

<!-- Rekap Log Harian -->
<div class="interactive-card" onclick="viewStudentTask('rekap')">
<div class="interactive-card-content">
<div class="flex items-center justify-between mb-4">
<div class="w-12 h-12 bg-gradient-primary rounded-full p-3">
<i class="fas fa-clipboard-list text-white text-sm flex items-center justify-center h-full"></i>
</div>
<span class="task-status pending" id="rekapStatus">
<i class="fas fa-clock"></i>
<span id="rekapCount">0</span>
</span>
</div>
<h3 class="text-lg font-semibold text-gray-800 mb-2">Rekap Log Harian</h3>
<p class="text-sm text-gray-600 mb-4">Log kegiatan</p>
<div class="task-progress">
<div class="task-progress-fill" id="rekapProgress" style="width: 0%"></div>
</div>
</div>
</div>

<!-- Laporan Harian -->
<div class="interactive-card" onclick="viewStudentTask('laporan')">
<div class="interactive-card-content">
<div class="flex items-center justify-between mb-4">
<div class="w-12 h-12 bg-gradient-danger rounded-full p-3">
<i class="fas fa-file-alt text-white text-sm flex items-center justify-center h-full"></i>
</div>
<span class="task-status pending" id="laporanStatus">
<i class="fas fa-clock"></i>
<span id="laporanCount">0</span>
</span>
</div>
<h3 class="text-lg font-semibold text-gray-800 mb-2">Laporan Harian</h3>
<p class="text-sm text-gray-600 mb-4">Laporan kegiatan</p>
<div class="task-progress">
<div class="task-progress-fill" id="laporanProgress" style="width: 0%"></div>
</div>
</div>
</div>

<!-- Screenshot -->
<div class="interactive-card" onclick="viewStudentTask('screenshot')">
<div class="interactive-card-content">
<div class="flex items-center justify-between mb-4">
<div class="w-12 h-12 bg-gradient-secondary rounded-full p-3">
<i class="fas fa-camera text-white text-sm flex items-center justify-center h-full"></i>
</div>
<span class="task-status pending" id="screenshotStatus">
<i class="fas fa-clock"></i>
<span id="screenshotCount">0</span>
</span>
</div>
<h3 class="text-lg font-semibold text-gray-800 mb-2">Screenshot</h3>
<p class="text-sm text-gray-600 mb-4">Bukti tugas</p>
<div class="task-progress">
<div class="task-progress-fill" id="screenshotProgress" style="width: 0%"></div>
</div>
</div>
</div>
</div>

<!-- Action Buttons -->
<div class="flex justify-between mt-8">
<button onclick="switchPage('pageStudentDetail','pageGuruDashboard')" class="btn btn-secondary">
<i class="fas fa-arrow-left"></i>
Kembali
</button>
<div class="flex gap-4">
<div class="export-menu">
<button class="btn btn-success">
<i class="fas fa-download"></i>
Export Data
</button>
<div class="export-dropdown">
<a href="#" onclick="exportStudentData('pdf')">Export PDF</a>
<a href="#" onclick="exportStudentData('excel')">Export Excel</a>
<a href="#" onclick="exportStudentData('json')">Export JSON</a>
</div>
</div>
<button onclick="openFeedbackModal()" class="btn btn-primary">
<i class="fas fa-comment"></i>
Kirim Feedback
</button>
</div>
</div>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN 4: DASHBOARD SISWA -->
<section id="page2" class="hidden min-h-screen p-6">
<div class="max-w-6xl mx-auto">
<!-- Profile Section -->
<div class="glass-card p-8 mb-8 animate-fadeInUp">
<div class="flex flex-col md:flex-row items-center gap-8">
<div class="flex flex-col items-center">
<div id="dashboardProfilePhotoContainer">
<div class="profile-photo-placeholder">
<i class="fas fa-user text-gray-400 text-3xl"></i>
</div>
</div>
<input type="file" id="dashboardProfilePhoto" accept="image/*" class="hidden" onchange="previewProfilePhoto(event, 'dashboardProfilePhotoContainer', true)">
<label for="dashboardProfilePhoto" class="btn btn-secondary mt-4">
<i class="fas fa-camera"></i>
Ganti Foto
</label>
</div>

<div class="flex-1 text-center md:text-left">
<h2 class="text-3xl font-bold text-gray-800 mb-6">PROFIL PENGGUNA</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label class="form-label">Nama</label>
<input type="text" id="profileNamaInput" class="form-input" placeholder="Nama">
</div>
<div>
<label class="form-label">Email</label>
<input type="email" id="profileEmailInput" class="form-input" placeholder="Email" readonly>
</div>
<div>
<label class="form-label">Sekolah</label>
<input type="text" id="profileSekolahInput" class="form-input" placeholder="Sekolah">
</div>
<div>
<label class="form-label">Program Studi</label>
<input type="text" id="profileProdiInput" class="form-input" placeholder="Program Studi">
</div>
</div>
<button onclick="saveProfileData()" class="btn btn-primary mt-6">
<i class="fas fa-save"></i>
Simpan Profil
</button>
</div>
</div>
</div>

<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
<div class="menu-card text-center animate-fadeInUp" style="animation-delay: 0.1s;">
<div class="w-16 h-16 bg-gradient-success rounded-full p-3 mx-auto mb-4">
<i class="fas fa-tasks text-white text-2xl flex items-center justify-center h-full"></i>
</div>
<h3 class="text-xl font-semibold text-gray-800 mb-2">Total Tugas</h3>
<div class="text-3xl font-bold text-primary" id="taskCount">00</div>
</div>

<div class="menu-card text-center animate-fadeInUp" style="animation-delay: 0.2s;">
<div class="w-16 h-16 bg-gradient-info rounded-full p-3 mx-auto mb-4">
<i class="fas fa-building text-white text-2xl flex items-center justify-center h-full"></i>
</div>
<h3 class="text-xl font-semibold text-gray-800 mb-2">Perpusnas RI</h3>
<p class="text-gray-600">Perpustakaan Nasional Republik Indonesia</p>
</div>

<div class="menu-card text-center animate-fadeInUp" style="animation-delay: 0.3s;">
<div class="w-16 h-16 bg-gradient-warning rounded-full p-3 mx-auto mb-4">
<i class="fas fa-map-marker-alt text-white text-2xl flex items-center justify-center h-full"></i>
</div>
<h3 class="text-xl font-semibold text-gray-800 mb-2">Alamat</h3>
<p class="text-gray-600">Jl. Medan Merdeka Selatan No. 11, Jakarta Pusat</p>
</div>
</div>

<!-- Chart Section -->
<div class="glass-card p-8 mb-8 animate-fadeInUp">
<h3 class="text-2xl font-bold text-gray-800 mb-6">Grafik Progress Tugas</h3>
<div class="chart-container">
<canvas id="studentProgressChart"></canvas>
</div>
</div>

<!-- Student Tasks Section -->
<div class="glass-card p-8 mb-8 animate-fadeInUp">
<h3 class="text-2xl font-bold text-gray-800 mb-6">Tugas Baru</h3>
<div id="studentTasksList" class="space-y-4">
<!-- Student tasks will be loaded here -->
</div>
</div>

<!-- Action Button -->
<div class="text-center">
<button onclick="switchPage('page2','page2Menu')" class="btn btn-primary px-8">
<i class="fas fa-arrow-right"></i>
Lanjut ke Menu
</button>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN MENU UTAMA SISWA -->
<section id="page2Menu" class="hidden min-h-screen p-6">
<div class="max-w-6xl mx-auto">
<!-- User Info Card -->
<div class="glass-card p-6 mb-8 animate-fadeInUp">
<div class="flex flex-col md:flex-row items-center gap-6">
<div id="menuProfilePhotoContainer">
<div class="profile-photo-placeholder">
<i class="fas fa-user text-gray-400 text-3xl"></i>
</div>
</div>
<div class="flex-1 text-center md:text-left">
<h2 class="text-2xl font-bold text-gray-800 mb-2">TUGAS MAGANG PERPUSTAKAAN</h2>
<p class="text-gray-600"><strong>Nama:</strong> <span id="displayNama">-</span></p>
<p class="text-gray-600"><strong>Email:</strong> <span id="displayEmail">-</span></p>
<p class="text-gray-600"><strong>Asal Sekolah:</strong> <span id="displayAsal">-</span></p>
<p class="text-gray-600"><strong>Tempat PKL:</strong> <span id="displayLokasi">-</span></p>
</div>
<img src="https://picsum.photos/seed/perpusnas-logo2/100/100.jpg" alt="Logo" class="w-20 h-20 rounded-full shadow-lg">
</div>
</div>

<!-- Tasks Section in Menu -->
<div class="glass-card p-8 mb-8 animate-fadeInUp">
<div class="flex justify-between items-center mb-6">
<h3 class="text-2xl font-bold text-gray-800">Tugas Baru</h3>
<div class="flex items-center gap-2">
<span class="text-sm text-gray-600">Total:</span>
<span class="text-2xl font-bold text-primary" id="menuTaskCount">00</span>
</div>
</div>
<div id="menuTasksList" class="space-y-4">
<!-- Student tasks will be loaded here -->
</div>
</div>

<!-- Menu Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
<div class="interactive-card animate-fadeInUp" style="animation-delay: 0.1s;" onclick="showDataHadir()">
<div class="interactive-card-content">
<div class="text-center">
<div class="w-16 h-16 bg-gradient-success rounded-full p-3 mx-auto mb-4">
<i class="fas fa-calendar-check text-white text-2xl flex items-center justify-center h-full"></i>
</div>
<h3 class="text-xl font-semibold text-gray-800 mb-2">Data Hadir</h3>
<p class="text-gray-600 mb-4">Catat kehadiran harian</p>
<button class="btn btn-success w-full">
<i class="fas fa-arrow-right"></i>
Buka
</button>
</div>
</div>
</div>

<div class="interactive-card animate-fadeInUp" style="animation-delay: 0.2s;" onclick="showMonitoringWebsiteMenu()">
<div class="interactive-card-content">
<div class="text-center">
<div class="w-16 h-16 bg-gradient-info rounded-full p-3 mx-auto mb-4">
<i class="fas fa-globe text-white text-2xl flex items-center justify-center h-full"></i>
</div>
<h3 class="text-xl font-semibold text-gray-800 mb-2">Monitoring Website</h3>
<p class="text-gray-600 mb-4">Pantau website perpustakaan</p>
<button class="btn btn-primary w-full">
<i class="fas fa-arrow-right"></i>
Buka
</button>
</div>
</div>
</div>

<div class="interactive-card animate-fadeInUp" style="animation-delay: 0.3s;" onclick="switchPage('page2Menu','pageNetwork')">
<div class="interactive-card-content">
<div class="text-center">
<div class="w-16 h-16 bg-gradient-warning rounded-full p-3 mx-auto mb-4">
<i class="fas fa-network-wired text-white text-2xl flex items-center justify-center h-full"></i>
</div>
<h3 class="text-xl font-semibold text-gray-800 mb-2">Monitoring Network</h3>
<p class="text-gray-600 mb-4">Pantau jaringan komputer</p>
<button class="btn btn-warning w-full">
<i class="fas fa-arrow-right"></i>
Buka
</button>
</div>
</div>
</div>

<div class="interactive-card animate-fadeInUp" style="animation-delay: 0.4s;" onclick="switchPage('page2Menu','pageRekap')">
<div class="interactive-card-content">
<div class="text-center">
<div class="w-16 h-16 bg-gradient-primary rounded-full p-3 mx-auto mb-4">
<i class="fas fa-clipboard-list text-white text-2xl flex items-center justify-center h-full"></i>
</div>
<h3 class="text-xl font-semibold text-gray-800 mb-2">Rekap Log Harian</h3>
<p class="text-sm text-gray-600 mb-4">Rekapitulasi kegiatan</p>
<button class="btn btn-primary w-full">
<i class="fas fa-arrow-right"></i>
Buka
</button>
</div>
</div>
</div>

<div class="interactive-card animate-fadeInUp" style="animation-delay: 0.5s;" onclick="switchPage('page2Menu','pageLaporan')">
<div class="interactive-card-content">
<div class="text-center">
<div class="w-16 h-16 bg-gradient-danger rounded-full p-3 mx-auto mb-4">
<i class="fas fa-file-alt text-white text-2xl flex items-center justify-center h-full"></i>
</div>
<h3 class="text-xl font-semibold text-gray-800 mb-2">Laporan Harian</h3>
<p class="text-gray-600 mb-4">Buat laporan kegiatan</p>
<button class="btn btn-danger w-full">
<i class="fas fa-arrow-right"></i>
Buka
</button>
</div>
</div>
</div>

<div class="interactive-card animate-fadeInUp" style="animation-delay: 0.6s;" onclick="switchPage('page2Menu','pageProfil')">
<div class="interactive-card-content">
<div class="text-center">
<div class="w-16 h-16 bg-gradient-secondary rounded-full p-3 mx-auto mb-4">
<i class="fas fa-user-cog text-white text-2xl flex items-center justify-center h-full"></i>
</div>
<h3 class="text-xl font-semibold text-gray-800 mb-2">Profil</h3>
<p class="text-gray-600 mb-4">Kelola profil pengguna</p>
<button class="btn btn-secondary w-full">
<i class="fas fa-arrow-right"></i>
Buka
</button>
</div>
</div>
</div>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN 5: DATA HADIR -->
<section id="pageAbsen" class="hidden min-h-screen p-6">
<div class="max-w-6xl mx-auto">
<div class="glass-card p-8 animate-fadeInUp">
<h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">
<i class="fas fa-calendar-check text-success mr-3"></i>
DATA HADIR
</h2>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
<!-- Form -->
<div>
<h3 class="text-xl font-semibold text-gray-800 mb-6">Form Kehadiran</h3>
<form id="absenForm" class="space-y-4" onsubmit="return false;">
<div>
<label class="form-label">Nama</label>
<input type="text" id="absenNama" class="form-input" placeholder="Masukkan nama">
</div>
<div>
<label class="form-label">Jurusan</label>
<input type="text" id="absenJurusan" class="form-input" placeholder="Masukkan jurusan">
</div>
<div>
<label class="form-label">Tanggal</label>
<input type="date" id="absenTanggal" class="form-input">
</div>
<div>
<label class="form-label">Asal Sekolah</label>
<input type="text" id="absenAsal" class="form-input" placeholder="Masukkan asal sekolah">
</div>
<div>
<label class="form-label">Status</label>
<select id="absenStatus" class="form-input">
<option value="Hadir">Hadir</option>
<option value="Tidak Hadir">Tidak Hadir</option>
</select>
</div>
<button type="button" onclick="simpanAbsen()" class="btn btn-success w-full">
<i class="fas fa-save"></i>
Simpan
</button>
</form>
</div>

<!-- List -->
<div>
<h3 class="text-xl font-semibold text-gray-800 mb-6">Riwayat Kehadiran</h3>
<div class="bg-gray-50 rounded-xl p-6 max-h-96 overflow-y-auto">
<ul id="absenList" class="space-y-3">
<!-- Data akan dimuat di sini -->
</ul>
</div>
</div>
</div>

<div class="text-center mt-8">
<button onclick="switchPage('pageAbsen','page2Menu')" class="btn btn-secondary">
<i class="fas fa-arrow-left"></i>
Kembali
</button>
</div>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN MENU MONITORING WEBSITE -->
<section id="pageMonitoringMenu" class="hidden min-h-screen p-6">
<div class="max-w-4xl mx-auto">
<div class="glass-card p-8 animate-fadeInUp text-center">
<div class="w-20 h-20 bg-gradient-info rounded-full p-3 mx-auto mb-6">
<i class="fas fa-globe text-white text-3xl flex items-center justify-center h-full"></i>
</div>
<h2 class="text-3xl font-bold text-gray-800 mb-4">MONITORING WEBSITE</h2>
<p class="text-gray-600 mb-8">Silahkan pilih menu monitoring website</p>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="interactive-card" onclick="showMonitoringForm()">
<div class="interactive-card-content">
<i class="fas fa-chart-line text-3xl text-info mb-3"></i>
<h3 class="font-semibold text-gray-800">Monitoring Data</h3>
</div>
</div>

<div class="interactive-card" onclick="showMonitoringScreenshot()">
<div class="interactive-card-content">
<i class="fas fa-camera text-3xl text-success mb-3"></i>
<h3 class="font-semibold text-gray-800">Screenshot</h3>
</div>
</div>

<div class="interactive-card" onclick="switchPage('pageMonitoringMenu','pageMonitoringHistory')">
<div class="interactive-card-content">
<i class="fas fa-history text-3xl text-warning mb-3"></i>
<h3 class="font-semibold text-gray-800">History Data</h3>
</div>
</div>

<div class="interactive-card" onclick="switchPage('pageMonitoringMenu','pageScreenshotHistory')">
<div class="interactive-card-content">
<i class="fas fa-images text-3xl text-primary mb-3"></i>
<h3 class="font-semibold text-gray-800">History Screenshot</h3>
</div>
</div>
</div>

<div class="mt-8">
<button onclick="switchPage('pageMonitoringMenu','page2Menu')" class="btn btn-secondary">
<i class="fas fa-arrow-left"></i>
Kembali
</button>
</div>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN FORM MONITORING WEBSITE -->
<section id="pageMonitoringForm" class="hidden min-h-screen p-6">
<div class="max-w-4xl mx-auto">
<div class="glass-card p-8 animate-fadeInUp">
<h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">
<i class="fas fa-chart-line text-info mr-3"></i>
MONITORING WEBSITE
</h2>

<form id="monitoringWebsiteForm" class="space-y-4" onsubmit="return false;">
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label class="form-label">Tanggal</label>
<input type="date" id="tanggal" name="tanggal" class="form-input" required>
</div>
<div>
<label class="form-label">Jumlah Data Katalog (Judul)</label>
<input type="number" id="judul" name="judul" class="form-input" required>
</div>
<div>
<label class="form-label">Jumlah Data Koleksi (Eksemplar)</label>
<input type="number" id="koleksi" name="koleksi" class="form-input" required>
</div>
<div>
<label class="form-label">Jumlah Data Anggota (Orang)</label>
<input type="number" id="anggota" name="anggota" class="form-input" required>
</div>
<div>
<label class="form-label">Jumlah Data Peminjaman (Transaksi)</label>
<input type="number" id="peminjaman" name="peminjaman" class="form-input" required>
</div>
<div>
<label class="form-label">Jumlah Judul Yang Dikarantina (Item)</label>
<input type="number" id="judul_karantina" name="judul_karantina" class="form-input" required>
</div>
<div>
<label class="form-label">Jumlah Eksemplar Yang Dikarantina (Item)</label>
<input type="number" id="eksemplar_karantina" name="eksemplar_karantina" class="form-input" required>
</div>
<div>
<label class="form-label">Jumlah Data Authority (Item)</label>
<input type="number" id="authority" name="authority" class="form-input" required>
</div>
<div>
<label class="form-label">Jumlah Katalog Tervalidasi (Item)</label>
<input type="number" id="katalog_tervalidasi" name="katalog_tervalidasi" class="form-input" required>
</div>
<div>
<label class="form-label">Jumlah Authority Tervalidasi (Item)</label>
<input type="number" id="authority_tervalidasi" name="authority_tervalidasi" class="form-input" required>
</div>
</div>

<div class="flex justify-between pt-4">
<button type="button" onclick="switchPage('pageMonitoringForm','pageMonitoringMenu')" class="btn btn-secondary">
<i class="fas fa-arrow-left"></i>
Kembali
</button>
<button type="button" onclick="confirmMonitoringData()" class="btn btn-primary">
<i class="fas fa-save"></i>
Simpan Data
</button>
</div>
</form>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN SCREENSHOT MONITORING WEBSITE -->
<section id="pageMonitoringScreenshot" class="hidden min-h-screen p-6">
<div class="max-w-4xl mx-auto">
<div class="glass-card p-8 animate-fadeInUp">
<h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">
<i class="fas fa-camera text-success mr-3"></i>
SCREENSHOT WEBSITE
</h2>

<div class="text-center mb-8">
<p class="text-gray-600">Upload screenshot bukti tugas untuk website berikut:</p>
</div>

<!-- INLIS Section -->
<div class="mb-8">
<div class="bg-gray-50 rounded-xl p-6">
<h3 class="text-xl font-semibold text-gray-800 mb-4">
<i class="fas fa-building text-info mr-2"></i>
INLIS Perpustakaan
</h3>
<div class="flex flex-col items-center">
<input type="file" id="inlis-upload" accept="image/*" class="hidden" onchange="previewInlisImage(event)">
<label for="inlis-upload" class="btn btn-primary mb-4">
<i class="fas fa-upload"></i>
Upload Screenshot
</label>
<a href="https://inlis.perpusnas.go.id/" target="_blank" class="text-info hover:underline">
https://inlis.perpusnas.go.id/
</a>
</div>
</div>
</div>

<!-- ONSEARCH Section -->
<div class="mb-8">
<div class="bg-gray-50 rounded-xl p-6">
<h3 class="text-xl font-semibold text-gray-800 mb-4">
<i class="fas fa-search text-warning mr-2"></i>
ONESEARCH
</h3>
<div class="flex flex-col items-center">
<input type="file" id="onesearch-upload" accept="image/*" class="hidden" onchange="previewOnesearchImage(event)">
<label for="onesearch-upload" class="btn btn-primary mb-4">
<i class="fas fa-upload"></i>
Upload Screenshot
</label>
<a href="https://onesearch.id/" target="_blank" class="text-info hover:underline">
https://onesearch.id/
</a>
</div>
</div>
</div>

<!-- Preview Container -->
<div class="screenshot-preview-container" id="screenshotPreviewContainer">
<!-- Screenshots akan dimuat di sini -->
</div>

<!-- Action Buttons -->
<div class="flex justify-between pt-4">
<button onclick="switchPage('pageMonitoringScreenshot','pageMonitoringMenu')" class="btn btn-secondary">
<i class="fas fa-arrow-left"></i>
Kembali
</button>
<button onclick="submitScreenshotData()" class="btn btn-success">
<i class="fas fa-check"></i>
Konfirmasi
</button>
</div>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN HISTORY MONITORING WEBSITE -->
<section id="pageMonitoringHistory" class="hidden min-h-screen p-6">
<div class="max-w-6xl mx-auto">
<div class="glass-card p-8 animate-fadeInUp">
<h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">
<i class="fas fa-history text-warning mr-3"></i>
HISTORY MONITORING WEBSITE
</h2>

<div class="overflow-x-auto">
<table class="custom-table w-full">
<thead>
<tr>
<th>No</th>
<th>Tanggal</th>
<th>Judul</th>
<th>Eksemplar</th>
<th>Anggota</th>
<th>Transaksi</th>
<th>Judul Karantina</th>
<th>Eksemplar Karantina</th>
<th>Data Authority</th>
<th>Katalog Valid</th>
<th>Authority Valid</th>
<th>Status</th>
<th>Aksi</th>
</tr>
</thead>
<tbody id="monitoringHistoryTableBody">
<!-- Data akan dimuat di sini -->
</tbody>
</table>
</div>

<div class="text-center mt-8">
<button onclick="switchPage('pageMonitoringHistory','pageMonitoringMenu')" class="btn btn-secondary">
<i class="fas fa-arrow-left"></i>
Kembali
</button>
</div>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN HISTORY SCREENSHOT WEBSITE -->
<section id="pageScreenshotHistory" class="hidden min-h-screen p-6">
<div class="max-w-6xl mx-auto">
<div class="glass-card p-8 animate-fadeInUp">
<h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">
<i class="fas fa-images text-primary mr-3"></i>
HISTORY SCREENSHOT WEBSITE
</h2>

<div id="screenshotHistoryContainer">
<!-- Screenshot history cards akan dimuat di sini -->
</div>

<div class="text-center mt-8">
<button onclick="switchPage('pageScreenshotHistory','pageMonitoringMenu')" class="btn btn-secondary">
<i class="fas fa-arrow-left"></i>
Kembali
</button>
</div>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN MONITORING NETWORK -->
<section id="pageNetwork" class="hidden min-h-screen p-6">
<div class="max-w-4xl mx-auto">
<div class="network-card animate-fadeInUp">
<!-- Header -->
<div class="network-header">
<h1>MONITORING NETWORK</h1>
</div>

<!-- Halaman Monitoring -->
<div id="monitoringPage" class="network-content">
<div class="text-center text-2xl font-semibold mb-6 text-gray-800">
Upload Screenshot Monitoring
</div>

<!-- Form Upload -->
<form id="monitoringForm" class="network-form" onsubmit="return false;">
<div class="network-form-group">
<label class="network-form-label">Ping Google 8.8.8.8 -t :</label>
<input type="file" accept="image/*" name="google" class="network-form-input" />
</div>
<div class="network-form-group">
<label class="network-form-label">Ping Core Mersela 192.168.1.253 -t :</label>
<input type="file" accept="image/*" name="mersela" class="network-form-input" />
</div>
<div class="network-form-group">
<label class="network-form-label">Ping Core Salemba 192.168.1.252 -t :</label>
<input type="file" accept="image/*" name="salemba" class="network-form-input" />
</div>
<div class="network-form-group">
<label class="network-form-label">Ping DNS 27.50.20.21 -t :</label>
<input type="file" accept="image/*" name="dns" class="network-form-input" />
</div>
<div class="network-form-group">
<label class="network-form-label">PRTG Network Monitor :</label>
<input type="file" accept="image/*" name="prtg" class="network-form-input" />
</div>
<div class="network-form-group">
<label class="network-form-label">Speedtest lokal :</label>
<input type="file" accept="image/*" name="lokal" class="network-form-input" />
</div>
<div class="network-form-group">
<label class="network-form-label">Speedtest Internasional :</label>
<input type="file" accept="image/*" name="internasional" class="network-form-input" />
</div>

<!-- Tombol -->
<div class="network-actions">
<button type="button" onclick="submitNetworkForm()" class="network-btn network-btn-primary">
<i class="fas fa-save mr-2"></i>
Simpan
</button>
</div>
</form>

<div class="text-center mt-5">
<button onclick="showHistory()" class="text-purple-700 underline hover:text-purple-900 transition">
Lihat Riwayat Upload
</button>
</div>
</div>

<!-- Halaman Riwayat -->
<div id="historyPage" class="hidden network-content">
<h2 class="text-2xl font-semibold mb-6 text-center text-gray-800">Riwayat Upload Screenshot</h2>
<div class="network-history">
<table class="network-table">
<thead>
<tr>
<th>Tanggal</th>
<th>Google</th>
<th>Mersela</th>
<th>Salemba</th>
<th>DNS</th>
<th>PRTG</th>
<th>Lokal</th>
<th>Internasional</th>
<th>Status</th>
<th>Aksi</th>
</tr>
</thead>
<tbody id="historyTable" class="text-center"></tbody>
</table>
</div>

<div class="network-actions">
<button onclick="clearHistory()" class="network-btn network-btn-danger">
<i class="fas fa-trash mr-2"></i>
Hapus Semua
</button>
<button onclick="showMonitoring()" class="network-btn network-btn-secondary">
<i class="fas fa-arrow-left mr-2"></i>
Kembali
</button>
</div>
</div>
</div>

<div class="text-center mt-6">
<button onclick="switchPage('pageNetwork','page2Menu')" class="btn btn-secondary">
<i class="fas fa-arrow-left"></i>
Kembali ke Menu
</button>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN REKAP LOG HARIAN -->
<section id="pageRekap" class="hidden min-h-screen p-6">
<div class="max-w-6xl mx-auto">
<div class="glass-card p-8 animate-fadeInUp">
<h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">
<i class="fas fa-clipboard-list text-primary mr-3"></i>
REKAP LOG HARIAN
</h2>

<div class="flex justify-between items-center mb-6">
<h3 class="text-xl font-semibold text-gray-800">Daftar Rekapitulasi</h3>
<button onclick="switchPage('pageRekap','pageRekapForm')" class="btn btn-primary">
<i class="fas fa-plus"></i>
Tambah Data
</button>
</div>

<div class="overflow-x-auto">
<table class="custom-table w-full">
<thead>
<tr>
<th>No</th>
<th>Tanggal</th>
<th>Kegiatan</th>
<th>Keterangan</th>
<th>Status</th>
<th>Aksi</th>
</tr>
</thead>
<tbody id="rekapTableBody">
<!-- Data akan dimuat di sini -->
</tbody>
</table>
</div>

<div class="text-center mt-8">
<button onclick="switchPage('pageRekap','page2Menu')" class="btn btn-secondary">
<i class="fas fa-arrow-left"></i>
Kembali
</button>
</div>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN FORM REKAP LOG HARIAN -->
<section id="pageRekapForm" class="hidden min-h-screen p-6">
<div class="max-w-4xl mx-auto">
<div class="glass-card p-8 animate-fadeInUp">
<h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">
<i class="fas fa-clipboard-list text-primary mr-3"></i>
TAMBAH REKAP LOG HARIAN
</h2>

<form id="rekapForm" class="space-y-6" onsubmit="return false;">
<div>
<label class="form-label">Tanggal</label>
<input type="date" id="rekapTanggal" class="form-input" required>
</div>

<div>
<label class="form-label">Kegiatan</label>
<input type="text" id="rekapKegiatan" class="form-input" placeholder="Masukkan kegiatan yang dilakukan" required>
</div>

<div>
<label class="form-label">Keterangan</label>
<textarea id="rekapKeterangan" rows="4" class="form-input" placeholder="Tambahkan keterangan jika diperlukan"></textarea>
</div>

<div class="flex justify-between">
<button type="button" onclick="switchPage('pageRekapForm','pageRekap')" class="btn btn-secondary">
<i class="fas fa-arrow-left"></i>
Kembali
</button>
<button type="button" onclick="submitRekapForm()" class="btn btn-primary">
<i class="fas fa-save"></i>
Simpan
</button>
</div>
</form>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN LAPORAN HARIAN -->
<section id="pageLaporan" class="hidden min-h-screen p-6">
<div class="max-w-4xl mx-auto">
<div class="glass-card p-8 animate-fadeInUp">
<h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">
<i class="fas fa-file-alt text-danger mr-3"></i>
LAPORAN HARIAN
</h2>

<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
<div class="interactive-card" onclick="switchPage('pageLaporan','pageRekapForm')">
<div class="interactive-card-content">
<i class="fas fa-clipboard-list text-3xl text-primary mb-3"></i>
<h3 class="font-semibold text-gray-800">Rekap Log Harian</h3>
</div>
</div>

<div class="interactive-card" onclick="switchPage('pageLaporan','pageLaporanForm')">
<div class="interactive-card-content">
<i class="fas fa-file-alt text-3xl text-danger mb-3"></i>
<h3 class="font-semibold text-gray-800">Buat Laporan</h3>
</div>
</div>

<div class="interactive-card" onclick="switchPage('pageLaporan','pageLaporanHistory')">
<div class="interactive-card-content">
<i class="fas fa-history text-3xl text-warning mb-3"></i>
<h3 class="font-semibold text-gray-800">History Laporan</h3>
</div>
</div>
</div>

<div class="text-center mt-8">
<button onclick="switchPage('pageLaporan','page2Menu')" class="btn btn-secondary">
<i class="fas fa-arrow-left"></i>
Kembali
</button>
</div>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN FORM LAPORAN HARIAN -->
<section id="pageLaporanForm" class="hidden min-h-screen p-6">
<div class="max-w-4xl mx-auto">
<div class="glass-card p-8 animate-fadeInUp">
<h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">
<i class="fas fa-file-alt text-danger mr-3"></i>
BUAT LAPORAN HARIAN
</h2>

<form id="laporanForm" class="space-y-6" onsubmit="return false;">
<div>
<label class="form-label">Tanggal</label>
<input type="date" id="laporanTanggal" class="form-input" required>
</div>

<div>
<label class="form-label">Nama Kegiatan</label>
<input type="text" id="namaKegiatan" class="form-input" placeholder="Masukkan nama kegiatan" required>
</div>

<div>
<label class="form-label">Deskripsi Kegiatan</label>
<textarea id="deskripsiKegiatan" rows="4" class="form-input" placeholder="Jelaskan kegiatan yang telah dilakukan" required></textarea>
</div>

<div>
<label class="form-label">Foto Dokumentasi</label>
<div class="flex items-center gap-4">
<input type="file" id="fotoDokumentasi" accept="image/*" class="hidden" onchange="previewLaporanImage(event)">
<label for="fotoDokumentasi" class="btn btn-secondary">
<i class="fas fa-camera"></i>
Upload Foto
</label>
<div id="laporanPreview" class="screenshot-preview bg-gray-100 rounded-lg"></div>
</div>
</div>

<div class="flex justify-between">
<button type="button" onclick="switchPage('pageLaporanForm','pageLaporan')" class="btn btn-secondary">
<i class="fas fa-arrow-left"></i>
Kembali
</button>
<button type="button" onclick="submitLaporanForm()" class="btn btn-danger">
<i class="fas fa-save"></i>
Simpan Laporan
</button>
</div>
</form>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN HISTORY LAPORAN HARIAN -->
<section id="pageLaporanHistory" class="hidden min-h-screen p-6">
<div class="max-w-6xl mx-auto">
<div class="glass-card p-8 animate-fadeInUp">
<h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">
<i class="fas fa-history text-warning mr-3"></i>
HISTORY LAPORAN HARIAN
</h2>

<div class="overflow-x-auto">
<table class="custom-table w-full">
<thead>
<tr>
<th>No</th>
<th>Nama Kegiatan</th>
<th>Tanggal</th>
<th>Status</th>
<th>Aksi</th>
</tr>
</thead>
<tbody id="laporanHistoryTableBody">
<!-- Data akan dimuat di sini -->
</tbody>
</table>
</div>

<div class="text-center mt-8">
<button onclick="switchPage('pageLaporanHistory','pageLaporan')" class="btn btn-secondary">
<i class="fas fa-arrow-left"></i>
Kembali
</button>
</div>
</div>
</div>
</section>

<!-- ðŸŒŸ HALAMAN PROFIL -->
<section id="pageProfil" class="hidden min-h-screen p-6">
<div class="max-w-4xl mx-auto">
<div class="glass-card p-8 animate-fadeInUp">
<h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">
<i class="fas fa-user-cog text-primary mr-3"></i>
PROFIL PENGGUNA
</h2>

<!-- Profile Photo Section -->
<div class="text-center mb-8">
<div id="profilPagePhotoContainer">
<div class="profile-photo-placeholder">
<i class="fas fa-user text-gray-400 text-3xl"></i>
</div>
</div>
<input type="file" id="profilPagePhoto" accept="image/*" class="hidden" onchange="previewProfilePhoto(event, 'profilPagePhotoContainer')">
<div class="flex justify-center gap-4 mt-4">
<label for="profilPagePhoto" class="btn btn-secondary">
<i class="fas fa-camera"></i>
Ganti Foto
</label>
<button onclick="removeProfilePhoto()" class="btn btn-danger">
<i class="fas fa-trash"></i>
Hapus Foto
</button>
</div>
</div>

<!-- Profile Form -->
<form class="space-y-6" onsubmit="return false;">
<div>
<label class="form-label">Nama Lengkap</label>
<input type="text" id="editNama" class="form-input" placeholder="Masukkan nama lengkap">
</div>

<div>
<label class="form-label">Email</label>
<input type="email" id="editEmail" class="form-input" placeholder="Masukkan email" readonly>
</div>

<div>
<label class="form-label">Asal Sekolah</label>
<input type="text" id="editSekolah" class="form-input" placeholder="Masukkan asal sekolah">
</div>

<div>
<label class="form-label">Tempat PKL/Magang</label>
<input type="text" id="editLokasi" class="form-input" placeholder="Masukkan tempat PKL/Magang">
</div>

<div>
<label class="form-label">Jurusan/Program Studi</label>
<input type="text" id="editJurusan" class="form-input" placeholder="Masukkan jurusan/program studi">
</div>

<button type="button" onclick="updateProfile()" class="btn btn-primary w-full">
<i class="fas fa-save"></i>
Update Profil
</button>
</form>

<!-- Account Info -->
<div class="mt-8 p-6 bg-gray-50 rounded-xl">
<h3 class="text-xl font-semibold text-gray-800 mb-4">Informasi Akun</h3>
<div class="space-y-2">
<p><strong>Username:</strong> <span id="infoUsername">-</span></p>
<p><strong>Email:</strong> <span id="infoEmail">-</span></p>
<p><strong>Nama:</strong> <span id="infoNama">-</span></p>
<p><strong>Asal Sekolah:</strong> <span id="infoSekolah">-</span></p>
<p><strong>Tempat PKL:</strong> <span id="infoLokasi">-</span></p>
<p><strong>Jurusan:</strong> <span id="infoJurusan">-</span></p>
<p><strong>Login Method:</strong> <span id="infoLoginMethod">-</span></p>
</div>
</div>

<div class="flex justify-between mt-8">
<button onclick="switchPage('pageProfil','page2Menu')" class="btn btn-secondary">
<i class="fas fa-arrow-left"></i>
Kembali
</button>
<button onclick="logout()" class="btn btn-danger">
<i class="fas fa-sign-out-alt"></i>
Logout
</button>
</div>
</div>
</div>
</section>

<!-- Floating Action Button -->
<div class="fab" onclick="goToTop()">
<i class="fas fa-arrow-up"></i>
</div>

<script>
// Variabel global untuk lightbox
let currentLightboxIndex = 0;
let currentLightboxImages = [];
let currentViewingStudent = null;
let currentEditingTask = null;
let currentViewingTask = null;
let taskSubmissionFiles = [];
let notifications = [];
let progressChart = null;
let studentProgressChart = null;

// Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyBfX7qQqB9vXj8YkFqL9mNnOoPpQqRrSs",
  authDomain: "web-magang-sync.firebaseapp.com",
  databaseURL: "https://web-magang-sync-default-rtdb.firebaseio.com",
  projectId: "web-magang-sync",
  storageBucket: "web-magang-sync.appspot.com",
  messagingSenderId: "123456789012",
  appId: "1:123456789012:web:abcdef1234567890"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// Sync status
let syncStatus = 'disconnected';
let syncRetryCount = 0;
const maxSyncRetries = 3;

// Update sync status UI
function updateSyncStatus(status) {
  syncStatus = status;
  const statusElement = document.getElementById('syncStatus');
  const statusTextElement = document.getElementById('syncStatusText');
  
  statusElement.className = `sync-status ${status}`;
  
  switch(status) {
    case 'connected':
      statusTextElement.textContent = 'Terhubung';
      break;
    case 'connecting':
      statusTextElement.textContent = 'Menghubungkan...';
      break;
    case 'disconnected':
      statusTextElement.textContent = 'Tidak Terhubung';
      break;
  }
}

// Initialize connection to Firebase
function initializeFirebaseConnection() {
  updateSyncStatus('connecting');
  
  const connectedRef = database.ref('.info/connected');
  connectedRef.on('value', (snapshot) => {
    if (snapshot.val() === true) {
      updateSyncStatus('connected');
      syncRetryCount = 0;
      // Initial sync when connected
      syncAllData();
    } else {
      updateSyncStatus('disconnected');
      // Try to reconnect
      if (syncRetryCount < maxSyncRetries) {
        setTimeout(() => {
          syncRetryCount++;
          initializeFirebaseConnection();
        }, 3000);
      }
    }
  });
}

// Sync all data with Firebase
function syncAllData() {
  if (syncStatus !== 'connected') return;
  
  // Get active user
  const activeUser = JSON.parse(localStorage.getItem("activeUser"));
  const activeGuru = JSON.parse(localStorage.getItem("activeGuru"));
  
  if (activeUser) {
    // Sync student data
    syncUserData(activeUser);
    syncTaskData();
    syncNotificationData();
  } else if (activeGuru) {
    // Sync guru data
    syncGuruData(activeGuru);
    syncTaskData();
    syncStudentData();
  }
}

// Sync user data with Firebase
function syncUserData(user) {
  if (syncStatus !== 'connected') return;
  
  const userRef = database.ref(`users/${user.username || user.email}`);
  
  // Get local data
  const localData = {
    username: user.username,
    email: user.email,
    name: user.name,
    asal: user.asal,
    lokasi: user.lokasi,
    jurusan: user.jurusan,
    profilePhoto: user.profilePhoto,
    loginMethod: user.loginMethod,
    lastUpdated: new Date().toISOString()
  };
  
  // Upload to Firebase
  userRef.set(localData)
    .then(() => {
      console.log('User data synced successfully');
    })
    .catch((error) => {
      console.error('Error syncing user data:', error);
    });
  
  // Listen for remote changes
  userRef.on('value', (snapshot) => {
    const remoteData = snapshot.val();
    if (remoteData && remoteData.lastUpdated > user.lastUpdated) {
      // Update local data with remote changes
      Object.assign(user, remoteData);
      localStorage.setItem("activeUser", JSON.stringify(user));
      displayUserData(user);
      
      // Update users array
      let users = JSON.parse(localStorage.getItem("users")) || [];
      const userIndex = users.findIndex(u => u.username === user.username || u.email === user.email);
      if (userIndex !== -1) {
        users[userIndex] = user;
        localStorage.setItem("users", JSON.stringify(users));
      }
      
      showNotif("ðŸ”„ Data profil diperbarui dari server", "info");
    }
  });
}

// Sync guru data with Firebase
function syncGuruData(guru) {
  if (syncStatus !== 'connected') return;
  
  const guruRef = database.ref(`gurus/${guru.username}`);
  
  // Get local data
  const localData = {
    username: guru.username,
    name: guru.name,
    role: guru.role,
    lastUpdated: new Date().toISOString()
  };
  
  // Upload to Firebase
  guruRef.set(localData)
    .then(() => {
      console.log('Guru data synced successfully');
    })
    .catch((error) => {
      console.error('Error syncing guru data:', error);
    });
  
  // Listen for remote changes
  guruRef.on('value', (snapshot) => {
    const remoteData = snapshot.val();
    if (remoteData && remoteData.lastUpdated > guru.lastUpdated) {
      // Update local data with remote changes
      Object.assign(guru, remoteData);
      localStorage.setItem("activeGuru", JSON.stringify(guru));
      document.getElementById("guruName").textContent = guru.name;
      
      showNotif("ðŸ”„ Data guru diperbarui dari server", "info");
    }
  });
}

// Sync task data with Firebase
function syncTaskData() {
  if (syncStatus !== 'connected') return;
  
  const tasksRef = database.ref('tasks');
  
  // Get local tasks
  const localTasks = JSON.parse(localStorage.getItem("tasks")) || [];
  
  // Upload to Firebase
  tasksRef.set(localTasks)
    .then(() => {
      console.log('Task data synced successfully');
    })
    .catch((error) => {
      console.error('Error syncing task data:', error);
    });
  
  // Listen for remote changes
  tasksRef.on('value', (snapshot) => {
    const remoteTasks = snapshot.val() || [];
    if (remoteTasks.length > 0) {
      localStorage.setItem("tasks", JSON.stringify(remoteTasks));
      
      // Update UI if on relevant page
      const currentPage = getCurrentPage();
      if (currentPage === 'pageGuruDashboard') {
        loadTasksList();
      } else if (currentPage === 'page2' || currentPage === 'page2Menu') {
        loadStudentTasks();
        loadMenuTasks();
      }
      
      showNotif("ðŸ”„ Data tugas diperbarui dari server", "info");
    }
  });
}

// Sync student data with Firebase
function syncStudentData() {
  if (syncStatus !== 'connected') return;
  
  const studentsRef = database.ref('users');
  
  // Get local students
  const localStudents = JSON.parse(localStorage.getItem("users")) || [];
  
  // Upload to Firebase
  studentsRef.set(localStudents)
    .then(() => {
      console.log('Student data synced successfully');
    })
    .catch((error) => {
      console.error('Error syncing student data:', error);
    });
  
  // Listen for remote changes
  studentsRef.on('value', (snapshot) => {
    const remoteStudents = snapshot.val() || [];
    if (remoteStudents.length > 0) {
      localStorage.setItem("users", JSON.stringify(remoteStudents));
      
      // Update UI if on relevant page
      const currentPage = getCurrentPage();
      if (currentPage === 'pageGuruDashboard') {
        loadStudentsList();
        updateGuruStats();
      }
      
      showNotif("ðŸ”„ Data siswa diperbarui dari server", "info");
    }
  });
}

// Sync notification data with Firebase
function syncNotificationData() {
  if (syncStatus !== 'connected') return;
  
  const activeUser = JSON.parse(localStorage.getItem("activeUser"));
  if (!activeUser) return;
  
  const notificationsRef = database.ref(`notifications/${activeUser.username || activeUser.email}`);
  
  // Get local notifications
  const localNotifications = JSON.parse(localStorage.getItem("notifications")) || [];
  
  // Upload to Firebase
  notificationsRef.set(localNotifications)
    .then(() => {
      console.log('Notification data synced successfully');
    })
    .catch((error) => {
      console.error('Error syncing notification data:', error);
    });
  
  // Listen for remote changes
  notificationsRef.on('value', (snapshot) => {
    const remoteNotifications = snapshot.val() || [];
    if (remoteNotifications.length > 0) {
      localStorage.setItem("notifications", JSON.stringify(remoteNotifications));
      notifications = remoteNotifications;
      loadNotifications();
      updateNotificationBadge();
      
      // Show notification for new items
      const newNotifications = remoteNotifications.filter(n => !n.read);
      if (newNotifications.length > 0) {
        showNotif(`ðŸ”” Anda memiliki ${newNotifications.length} notifikasi baru`, "info");
      }
    }
  });
}

// Konfigurasi Google Sign-In
window.onGoogleLibraryLoad = function() {
  google.accounts.id.initialize({
    client_id: "GANTI_DENGAN_CLIENT_ID_ANDA", // Ganti dengan Client ID Anda
    callback: handleGoogleSignIn,
    auto_select: false,
    cancel_on_tap_outside: true
  });
};

// ðŸ”„ Navigasi Halaman
function switchPage(hideId, showId) {
  const hideEl = document.getElementById(hideId);
  const showEl = document.getElementById(showId);

  if (hideEl && showEl) {
    hideEl.style.display = 'none';
    showEl.style.display = 'block';
    showEl.classList.add('animate-fadeInUp');
    
    // Load appropriate data based on the page being shown
    if (showId === 'page2') {
      // Main dashboard - load student tasks
      loadStudentTasks();
      loadStudentProgressChart();
    } else if (showId === 'page2Menu') {
      // Menu page - load tasks in menu
      loadMenuTasks();
    } else if (showId === 'pageProfil') {
      // Profile page - update profile info
      updateProfilePage();
    } else if (showId === 'pageGuruDashboard') {
      // Guru dashboard - load guru data
      loadGuruDashboard();
      loadProgressChart();
    } else if (showId === 'pageStudentDetail') {
      // Student detail - load student data
      if (currentViewingStudent) {
        viewStudentDetail(currentViewingStudent);
      }
    }
  }
}

// ðŸ‘‡ Navigasi antar halaman utama
function goToLogin() {
  switchPage("page1", "pageLogin");
}

function goToGuruLogin() {
  switchPage("page1", "pageGuruLogin");
}

function goToRegister() {
  switchPage("pageLogin", "pageRegister");
}

function showDataHadir() {
  switchPage("page2Menu", "pageAbsen");
}

function showMonitoringWebsiteMenu() {
  switchPage("page2Menu", "pageMonitoringMenu");
}

function showMonitoringForm() {
  switchPage("pageMonitoringMenu", "pageMonitoringForm");
}

function showMonitoringScreenshot() {
  switchPage("pageMonitoringMenu", "pageMonitoringScreenshot");
}

// ðŸ”” Notifikasi
function showNotif(msg, type = "success") {
  const notif = document.getElementById("notification");
  const notifText = document.getElementById("notificationText");

  notifText.textContent = msg;
  notif.className = `notification ${type}`;

  // Update icon based on type
  const icon = notif.querySelector('i');
  if (type === "success") {
    icon.className = 'fas fa-check-circle';
  } else if (type === "error") {
    icon.className = 'fas fa-exclamation-circle';
  } else if (type === "info") {
    icon.className = 'fas fa-info-circle';
  }

  notif.classList.add('show');

  setTimeout(() => {
    notif.classList.remove('show');
  }, 3000);
}

// ðŸ“¸ Preview Profile Photo
function previewProfilePhoto(event, containerId, isDashboard = false) {
  const file = event.target.files[0];
  const container = document.getElementById(containerId);

  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      const imgClass = isDashboard ? "profile-photo" : "profile-photo";
      container.innerHTML = `<img src="${e.target.result}" class="${imgClass}" onclick="viewImage('${e.target.result}')" />`;

      // Simpan foto ke localStorage
      let activeUser = JSON.parse(localStorage.getItem("activeUser"));
      if (activeUser) {
        activeUser.profilePhoto = e.target.result;
        localStorage.setItem("activeUser", JSON.stringify(activeUser));

        // Update di users array
        let users = JSON.parse(localStorage.getItem("users")) || [];
        const userIndex = users.findIndex(u => u.username === activeUser.username || u.email === activeUser.email);
        if (userIndex !== -1) {
          users[userIndex].profilePhoto = e.target.result;
          localStorage.setItem("users", JSON.stringify(users));
        }

        // Update foto di semua tempat
        updateProfilePhotos();
        
        // Sync with Firebase
        if (syncStatus === 'connected') {
          syncUserData(activeUser);
        }
      }
    }
    reader.readAsDataURL(file);
  }
}

// ðŸ—‘ï¸ Remove Profile Photo
function removeProfilePhoto() {
  if (confirm("Apakah Anda yakin ingin menghapus foto profil?")) {
    let activeUser = JSON.parse(localStorage.getItem("activeUser"));
    if (activeUser) {
      activeUser.profilePhoto = null;
      localStorage.setItem("activeUser", JSON.stringify(activeUser));

      // Update di users array
      let users = JSON.parse(localStorage.getItem("users")) || [];
      const userIndex = users.findIndex(u => u.username === activeUser.username || u.email === activeUser.email);
      if (userIndex !== -1) {
        users[userIndex].profilePhoto = null;
        localStorage.setItem("users", JSON.stringify(users));
      }

      // Update foto di semua tempat
      updateProfilePhotos();
      
      // Sync with Firebase
      if (syncStatus === 'connected') {
        syncUserData(activeUser);
      }

      showNotif("âœ… Foto profil berhasil dihapus!");
    }
  }
}

// ðŸ”„ Update Profile Photos in All Places
function updateProfilePhotos() {
  const activeUser = JSON.parse(localStorage.getItem("activeUser"));
  if (!activeUser) return;

  const photoSrc = activeUser.profilePhoto || null;

  // Update dashboard profile photo
  const dashboardContainer = document.getElementById("dashboardProfilePhotoContainer");
  if (photoSrc) {
    dashboardContainer.innerHTML = `<img src="${photoSrc}" class="profile-photo" onclick="viewImage('${photoSrc}')" />`;
  } else {
    dashboardContainer.innerHTML = `
    <div class="profile-photo-placeholder">
    <i class="fas fa-user text-gray-400 text-3xl"></i>
    </div>
    `;
  }

  // Update menu profile photo
  const menuContainer = document.getElementById("menuProfilePhotoContainer");
  if (photoSrc) {
    menuContainer.innerHTML = `<img src="${photoSrc}" class="profile-photo" onclick="viewImage('${photoSrc}')" />`;
  } else {
    menuContainer.innerHTML = `
    <div class="profile-photo-placeholder">
    <i class="fas fa-user text-gray-400 text-3xl"></i>
    </div>
    `;
  }

  // Update profil page photo
  const profilContainer = document.getElementById("profilPagePhotoContainer");
  if (photoSrc) {
    profilContainer.innerHTML = `<img src="${photoSrc}" class="profile-photo" onclick="viewImage('${photoSrc}')" />`;
  } else {
    profilContainer.innerHTML = `
    <div class="profile-photo-placeholder">
    <i class="fas fa-user text-gray-400 text-3xl"></i>
    </div>
    `;
  }
}

// ==================== GOOGLE SIGN-IN & EMAIL AUTHENTICATION ====================

// Fungsi untuk menggunakan akun demo
function useDemoAccount() {
  const demoUsers = [
    {
      username: "demo1@gmail.com",
      email: "demo1@gmail.com",
      name: "Ahmad Rizki",
      profilePhoto: "https://picsum.photos/seed/demo1/200/200.jpg",
      asal: "SMK Negeri 1 Jakarta",
      lokasi: "Perpusnas RI",
      jurusan: "Teknik Informatika",
      loginMethod: 'demo'
    },
    {
      username: "demo2@gmail.com",
      email: "demo2@gmail.com",
      name: "Siti Nurhaliza",
      profilePhoto: "https://picsum.photos/seed/demo2/200/200.jpg",
      asal: "SMK Negeri 2 Bandung",
      lokasi: "Perpusnas RI",
      jurusan: "Sistem Informasi",
      loginMethod: 'demo'
    }
  ];

  // Pilih user demo secara acak
  const randomUser = demoUsers[Math.floor(Math.random() * demoUsers.length)];

  // Check if user exists
  let users = JSON.parse(localStorage.getItem("users")) || [];
  let existingUser = users.find(u => u.email === randomUser.email);

  if (!existingUser) {
    users.push(randomUser);
    localStorage.setItem("users", JSON.stringify(users));
  }

  // Login dengan akun demo
  localStorage.setItem("activeUser", JSON.stringify(randomUser));
  displayUserData(randomUser);
  
  // Sync with Firebase
  if (syncStatus === 'connected') {
    syncUserData(randomUser);
  }
  
  showNotif("âœ… Login dengan akun demo berhasil!");
  switchPage("pageLogin","page2");
}

// Fungsi untuk inisialisasi Google Sign-In
function initializeGoogleSignIn() {
  // Cek apakah library Google sudah dimuat
  if (typeof google === 'undefined' || !google.accounts || !google.accounts.id) {
    showNotif("âš ï¸ Library Google belum dimuat. Silakan refresh halaman.", "error");
    return;
  }

  // Tampilkan popup sign-in
  google.accounts.id.prompt((notification) => {
    if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
      // Jika popup tidak ditampilkan, gunakan tombol
      renderGoogleSignInButton();
    }
  });
}

// Fungsi untuk inisialisasi Google Sign-Up
function initializeGoogleSignUp() {
  // Cek apakah library Google sudah dimuat
  if (typeof google === 'undefined' || !google.accounts || !google.accounts.id) {
    showNotif("âš ï¸ Library Google belum dimuat. Silakan refresh halaman.", "error");
    return;
  }

  // Tampilkan popup sign-in
  google.accounts.id.prompt((notification) => {
    if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
      // Jika popup tidak ditampilkan, gunakan tombol
      renderGoogleSignInButton();
    }
  });
}

// Fungsi untuk render tombol Google Sign-In
function renderGoogleSignInButton() {
  // Buat container untuk tombol jika belum ada
  let buttonContainer = document.getElementById('google-signin-button');
  if (!buttonContainer) {
    buttonContainer = document.createElement('div');
    buttonContainer.id = 'google-signin-button';
    buttonContainer.className = 'flex justify-center my-4';
    
    // Cari posisi yang tepat untuk menambahkan tombol
    const googleBtn = document.querySelector('.google-btn');
    if (googleBtn && googleBtn.parentNode) {
      googleBtn.parentNode.insertBefore(buttonContainer, googleBtn.nextSibling);
    }
  }
  
  // Render tombol Google Sign-In
  google.accounts.id.renderButton(buttonContainer, {
    theme: 'outline',
    size: 'large',
    text: 'signin_with',
    shape: 'rectangular',
    logo_alignment: 'left'
  });
}

// Fungsi untuk memproses data user Google
function processGoogleUser(googleUser) {
  // Check if user exists
  let users = JSON.parse(localStorage.getItem("users")) || [];
  let existingUser = users.find(u => u.email === googleUser.email);

  if (existingUser) {
    // User exists, login
    localStorage.setItem("activeUser", JSON.stringify(existingUser));
    displayUserData(existingUser);
    
    // Sync with Firebase
    if (syncStatus === 'connected') {
      syncUserData(existingUser);
    }
    
    showNotif("âœ… Login berhasil dengan Google!");
    switchPage("pageLogin","page2");
  } else {
    // New user, create account
    const newUser = {
      username: googleUser.email,
      email: googleUser.email,
      name: googleUser.name,
      profilePhoto: googleUser.picture,
      asal: "",
      lokasi: "",
      jurusan: "",
      loginMethod: 'google'
    };

    users.push(newUser);
    localStorage.setItem("users", JSON.stringify(users));
    localStorage.setItem("activeUser", JSON.stringify(newUser));
    
    // Sync with Firebase
    if (syncStatus === 'connected') {
      syncUserData(newUser);
    }

    // Redirect to profile completion
    displayUserData(newUser);
    showNotif("âœ… Akun Google berhasil dibuat! Silakan lengkapi profil Anda.");
    switchPage("pageLogin","pageProfil");
  }
}

// Ganti fungsi handleGoogleSignIn dengan ini
function handleGoogleSignIn(response) {
  try {
    // Decode JWT token
    const responsePayload = decodeJwtResponse(response.credential);

    // Extract user information
    const googleUser = {
      email: responsePayload.email,
      name: responsePayload.name,
      picture: responsePayload.picture,
      given_name: responsePayload.given_name,
      family_name: responsePayload.family_name,
      loginMethod: 'google'
    };

    // Proses login dengan data Google
    processGoogleUser(googleUser);
  } catch (error) {
    console.error("Google Sign-In Error:", error);
    showNotif("âš ï¸ Terjadi kesalahan saat memproses data Google. Gunakan login email.", "error");
  }
}

// Decode JWT token dari Google
function decodeJwtResponse(token) {
  const base64Url = token.split('.')[1];
  const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
  const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
  }).join(''));

  return JSON.parse(jsonPayload);
}

// Email Login Handler
function loginWithEmail() {
  const email = document.getElementById('loginEmail').value.trim();
  const password = document.getElementById('loginPassword').value.trim();

  if (!email || !password) {
    showNotif("âš ï¸ Isi email dan password!", "error");
    return;
  }

  const users = JSON.parse(localStorage.getItem("users")) || [];
  const user = users.find(u => u.email === email && u.password === password);

  if (!user) {
    showNotif("âš ï¸ Email atau password salah!", "error");
    return;
  }

  localStorage.setItem("activeUser", JSON.stringify(user));
  displayUserData(user);
  
  // Sync with Firebase
  if (syncStatus === 'connected') {
    syncUserData(user);
  }
  
  showNotif("âœ… Login berhasil!");
  switchPage("pageLogin","page2");
}

// Email Registration Handler
function registerWithEmail() {
  const email = document.getElementById('regEmail').value.trim();
  const password = document.getElementById('regPassword').value.trim();
  const nama = document.getElementById('regNama').value.trim();
  const asal = document.getElementById('regAsal').value.trim();
  const lokasi = document.getElementById('regLokasi').value.trim();

  if (!email || !password || !nama || !asal || !lokasi) {
    showNotif("âš ï¸ Semua field harus diisi!", "error");
    return;
  }

  // Validate email format
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    showNotif("âš ï¸ Format email tidak valid!", "error");
    return;
  }

  let users = JSON.parse(localStorage.getItem("users")) || [];
  if (users.find(u => u.email === email)) {
    showNotif("âŒ Email sudah terdaftar!", "error");
    return;
  }

  // Get profile photo if uploaded
  let profilePhoto = null;
  const photoPreview = document.querySelector('#regProfilePhotoPreview img');
  if (photoPreview) {
    profilePhoto = photoPreview.src;
  }

  const newUser = {
    username: email,
    email: email,
    name: nama,
    password: password,
    asal: asal,
    lokasi: lokasi,
    jurusan: "",
    profilePhoto: profilePhoto,
    loginMethod: 'email'
  };

  users.push(newUser);
  localStorage.setItem("users", JSON.stringify(users));
  
  // Sync with Firebase
  if (syncStatus === 'connected') {
    syncUserData(newUser);
  }
  
  showNotif("âœ… Akun berhasil dibuat! Silakan login.");
  switchPage("pageRegister", "pageLogin");
}

// ==================== END GOOGLE SIGN-IN & EMAIL AUTHENTICATION ====================

// ðŸ‘¤ Tampilkan Data User
function displayUserData(user) {
  // Tampilkan di dashboard menu
  document.getElementById("displayNama").textContent = user.name || user.username;
  document.getElementById("displayEmail").textContent = user.email || "-";
  document.getElementById("displayAsal").textContent = user.asal;
  document.getElementById("displayLokasi").textContent = user.lokasi || "Belum diisi";

  // Tampilkan di profil page
  document.getElementById("infoUsername").textContent = user.username;
  document.getElementById("infoEmail").textContent = user.email || "-";
  document.getElementById("infoNama").textContent = user.name || user.username;
  document.getElementById("infoSekolah").textContent = user.asal;
  document.getElementById("infoLokasi").textContent = user.lokasi || "Belum diisi";
  document.getElementById("infoJurusan").textContent = user.jurusan || "Belum diisi";
  document.getElementById("infoLoginMethod").textContent = user.loginMethod || "username";

  // Isi form edit profil
  document.getElementById("editNama").value = user.name || user.username;
  document.getElementById("editEmail").value = user.email || "";
  document.getElementById("editSekolah").value = user.asal;
  document.getElementById("editLokasi").value = user.lokasi || "";
  document.getElementById("editJurusan").value = user.jurusan || "";

  // Isi form profil di page2
  document.getElementById("profileNamaInput").value = user.name || user.username;
  document.getElementById("profileEmailInput").value = user.email || "";
  document.getElementById("profileSekolahInput").value = user.asal;
  document.getElementById("profileProdiInput").value = user.jurusan || "";

  // Update profile photos
  updateProfilePhotos();
}

// ðŸ’¾ Simpan Data Profil di Page2
function saveProfileData() {
  const nama = document.getElementById("profileNamaInput").value.trim();
  const sekolah = document.getElementById("profileSekolahInput").value.trim();
  const prodi = document.getElementById("profileProdiInput").value.trim();

  if (!nama || !sekolah) {
    showNotif("âš ï¸ Nama dan sekolah harus diisi!", "error");
    return;
  }

  // Update user data di localStorage
  let activeUser = JSON.parse(localStorage.getItem("activeUser"));
  if (activeUser) {
    activeUser.name = nama;
    activeUser.asal = sekolah;
    activeUser.jurusan = prodi;
    activeUser.lastUpdated = new Date().toISOString();

    // Update di users array
    let users = JSON.parse(localStorage.getItem("users")) || [];
    const userIndex = users.findIndex(u => u.username === activeUser.username || u.email === activeUser.email);
    if (userIndex !== -1) {
      users[userIndex] = activeUser;
      localStorage.setItem("users", JSON.stringify(users));
    }

    // Update active user
    localStorage.setItem("activeUser", JSON.stringify(activeUser));

    // Update display
    displayUserData(activeUser);
    
    // Sync with Firebase
    if (syncStatus === 'connected') {
      syncUserData(activeUser);
    }

    showNotif("âœ… Profil berhasil diperbarui!");
  }
}

// ðŸ”„ Update Profil dari Halaman Profil
function updateProfile() {
  const nama = document.getElementById("editNama").value.trim();
  const sekolah = document.getElementById("editSekolah").value.trim();
  const lokasi = document.getElementById("editLokasi").value.trim();
  const jurusan = document.getElementById("editJurusan").value.trim();

  if (!nama || !sekolah) {
    showNotif("âš ï¸ Nama dan sekolah harus diisi!", "error");
    return;
  }

  // Update user data di localStorage
  let activeUser = JSON.parse(localStorage.getItem("activeUser"));
  if (activeUser) {
    activeUser.name = nama;
    activeUser.asal = sekolah;
    activeUser.lokasi = lokasi;
    activeUser.jurusan = jurusan;
    activeUser.lastUpdated = new Date().toISOString();

    // Update di users array
    let users = JSON.parse(localStorage.getItem("users")) || [];
    const userIndex = users.findIndex(u => u.username === activeUser.username || u.email === activeUser.email);
    if (userIndex !== -1) {
      users[userIndex] = activeUser;
      localStorage.setItem("users", JSON.stringify(users));
    }

    // Update active user
    localStorage.setItem("activeUser", JSON.stringify(activeUser));

    // Update display
    displayUserData(activeUser);
    
    // Sync with Firebase
    if (syncStatus === 'connected') {
      syncUserData(activeUser);
    }

    showNotif("âœ… Profil berhasil diperbarui!");
  }
}

// ðŸšª Logout
function logout() {
  if (confirm("Apakah Anda yakin ingin logout?")) {
    localStorage.removeItem("activeUser");
    showNotif("âœ… Anda telah logout!");
    switchPage("pageProfil", "page1");
  }
}

// ðŸ“… Absen
function simpanAbsen() {
  const nama = document.getElementById('absenNama').value.trim();
  const jurusan = document.getElementById('absenJurusan').value.trim();
  const tanggal = document.getElementById('absenTanggal').value;
  const asal = document.getElementById('absenAsal').value.trim();
  const status = document.getElementById('absenStatus').value;

  if(!nama || !jurusan || !tanggal || !asal) {
    showNotif("âš ï¸ Lengkapi semua data absen!", "error");
    return;
  }

  const absenList = JSON.parse(localStorage.getItem("absenList")) || [];
  const newAbsen = {
    id: Date.now(),
    nama,
    jurusan,
    tanggal,
    asal,
    status,
    userId: JSON.parse(localStorage.getItem("activeUser")).username || JSON.parse(localStorage.getItem("activeUser")).email,
    createdAt: new Date().toISOString()
  };
  
  absenList.push(newAbsen);
  localStorage.setItem("absenList", JSON.stringify(absenList));
  
  // Sync with Firebase
  if (syncStatus === 'connected') {
    database.ref('absenList').set(absenList);
  }
  
  tampilAbsen();
  showNotif("âœ… Data absen tersimpan!");

  // Reset form
  document.getElementById('absenForm').reset();
}

function tampilAbsen() {
  const list = JSON.parse(localStorage.getItem("absenList")) || [];
  const absenListEl = document.getElementById("absenList");
  absenListEl.innerHTML = "";

  if (list.length === 0) {
    absenListEl.innerHTML = '<p class="text-gray-500 text-center">Belum ada data kehadiran</p>';
    return;
  }

  // Sort by date (newest first)
  list.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));

  list.forEach(a => {
    const li = document.createElement("li");
    li.className = 'bg-white p-3 rounded-lg shadow-sm';
    li.innerHTML = `
    <div class="flex justify-between items-center">
    <div>
    <p class="font-semibold">${a.nama}</p>
    <p class="text-sm text-gray-600">${a.asal} - ${a.jurusan}</p>
    </div>
    <div class="text-right">
    <p class="text-sm">${a.tanggal}</p>
    <span class="status-badge ${a.status === 'Hadir' ? 'success' : 'pending'}">${a.status}</span>
    </div>
    </div>
    `;
    absenListEl.appendChild(li);
  });
}

// ðŸŒ Monitoring Website - Form
function confirmMonitoringData() {
  const data = {
    id: Date.now(),
    tanggal: document.getElementById('tanggal').value,
    judul: document.getElementById('judul').value,
    koleksi: document.getElementById('koleksi').value,
    anggota: document.getElementById('anggota').value,
    peminjaman: document.getElementById('peminjaman').value,
    judul_karantina: document.getElementById('judul_karantina').value,
    eksemplar_karantina: document.getElementById('eksemplar_karantina').value,
    authority: document.getElementById('authority').value,
    katalog_tervalidasi: document.getElementById('katalog_tervalidasi').value,
    authority_tervalidasi: document.getElementById('authority_tervalidasi').value,
    userId: JSON.parse(localStorage.getItem("activeUser")).username || JSON.parse(localStorage.getItem("activeUser")).email,
    createdAt: new Date().toISOString()
  };

  // Validasi
  if (!data.tanggal || !data.judul || !data.koleksi || !data.anggota || !data.peminjaman) {
    showNotif("âš ï¸ Lengkapi semua field yang wajib diisi!", "error");
    return;
  }

  // Simpan ke localStorage
  let monitoringList = JSON.parse(localStorage.getItem("monitoringList")) || [];
  monitoringList.push(data);
  localStorage.setItem("monitoringList", JSON.stringify(monitoringList));
  
  // Sync with Firebase
  if (syncStatus === 'connected') {
    database.ref('monitoringList').set(monitoringList);
  }

  // Reset form
  document.getElementById('monitoringWebsiteForm').reset();

  showNotif("âœ… Data monitoring website berhasil disimpan!");

  // Tampilkan data setelah menyimpan
  setTimeout(() => {
    switchPage("pageMonitoringForm","pageMonitoringHistory");
    loadMonitoringHistory();
  }, 1000);
}

// ðŸ“Š Tampilkan Data Monitoring History
function loadMonitoringHistory() {
  const monitoringList = JSON.parse(localStorage.getItem("monitoringList")) || [];
  const tableBody = document.getElementById("monitoringHistoryTableBody");

  tableBody.innerHTML = "";

  if (monitoringList.length === 0) {
    tableBody.innerHTML = '<tr><td colspan="12" class="text-center py-8 text-gray-500">Belum ada data monitoring</td></tr>';
    return;
  }

  // Sort by date (newest first)
  monitoringList.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));

  monitoringList.forEach((item, index) => {
    const isCompleted = item.completed || false;
    const row = document.createElement("tr");
    row.innerHTML = `
    <td>${index + 1}</td>
    <td>${item.tanggal}</td>
    <td>${item.judul}</td>
    <td>${item.koleksi}</td>
    <td>${item.anggota}</td>
    <td>${item.peminjaman}</td>
    <td>${item.judul_karantina}</td>
    <td>${item.eksemplar_karantina}</td>
    <td>${item.authority}</td>
    <td>${item.katalog_tervalidasi}</td>
    <td>${item.authority_tervalidasi}</td>
    <td>
    <span class="status-badge ${isCompleted ? 'success' : 'pending'}">
     ${isCompleted ? 'Selesai' : 'Pending'}
    </span>
    </td>
    <td>
    <button onclick="markMonitoringCompleted(${item.id})" class="btn btn-success btn-sm">
    <i class="fas fa-check"></i>
    </button>
    </td>
    `;
    tableBody.appendChild(row);
  });
}

// ðŸ“„ Preview Inlis Image
function previewInlisImage(event) {
  const file = event.target.files[0];
  const previewContainer = document.getElementById('screenshotPreviewContainer');

  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      // Cek apakah sudah ada preview untuk INLIS
      let inlisPreview = document.getElementById('inlis-preview');
      if (!inlisPreview) {
        inlisPreview = document.createElement('div');
        inlisPreview.id = 'inlis-preview';
        inlisPreview.className = 'screenshot-item';
        previewContainer.appendChild(inlisPreview);
      }

      inlisPreview.innerHTML = `
      <img src="${e.target.result}" alt="INLIS Screenshot" class="screenshot-preview" onclick="viewImage('${e.target.result}')" />
      <div class="screenshot-actions">
      <button class="screenshot-btn view" onclick="viewImage('${e.target.result}')">
      <i class="fas fa-eye"></i>
      </button>
      <button class="screenshot-btn delete" onclick="removePreview('inlis-preview')">
      <i class="fas fa-times"></i>
      </button>
      </div>
      `;
    }
    reader.readAsDataURL(file);
  }
}

// ðŸ“„ Preview Onesearch Image
function previewOnesearchImage(event) {
  const file = event.target.files[0];
  const previewContainer = document.getElementById('screenshotPreviewContainer');

  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      // Cek apakah sudah ada preview untuk ONSEARCH
      let onearchPreview = document.getElementById('onearch-preview');
      if (!onearchPreview) {
        onearchPreview = document.createElement('div');
        onearchPreview.id = 'onearch-preview';
        onearchPreview.className = 'screenshot-item';
        previewContainer.appendChild(onearchPreview);
      }

      onearchPreview.innerHTML = `
      <img src="${e.target.result}" alt="OneSearch Screenshot" class="screenshot-preview" onclick="viewImage('${e.target.result}')" />
      <div class="screenshot-actions">
      <button class="screenshot-btn view" onclick="viewImage('${e.target.result}')">
      <i class="fas fa-eye"></i>
      </button>
      <button class="screenshot-btn delete" onclick="removePreview('onearch-preview')">
      <i class="fas fa-times"></i>
      </button>
      </div>
      `;
    }
    reader.readAsDataURL(file);
  }
}

// ðŸ—‘ï¸ Remove Preview
function removePreview(previewId) {
  const preview = document.getElementById(previewId);
  if (preview) {
    preview.remove();
  }
}

// ðŸ“„ Submit Data Screenshot
function submitScreenshotData() {
  // Validasi upload file
  const inlisFile = document.getElementById('inlis-upload').files[0];
  const onearchFile = document.getElementById('onesearch-upload').files[0];

  if (!inlisFile || !onearchFile) {
    showNotif("âš ï¸ Upload screenshot untuk kedua website!", "error");
    return;
  }

  // Baca file sebagai base64 untuk disimpan
  const inlisReader = new FileReader();
  const onearchReader = new FileReader();

  inlisReader.onload = function(e) {
    onearchReader.onload = function(e2) {
      // Simpan data screenshot ke localStorage
      const websiteScreenshots = JSON.parse(localStorage.getItem("websiteScreenshots")) || [];
      const newScreenshot = {
        id: Date.now(),
        date: new Date().toISOString().slice(0,10),
        inlis: {
          name: inlisFile.name,
          data: e.target.result
        },
        onearch: {
          name: onearchFile.name,
          data: e2.target.result
        },
        userId: JSON.parse(localStorage.getItem("activeUser")).username || JSON.parse(localStorage.getItem("activeUser")).email,
        createdAt: new Date().toISOString()
      };
      
      websiteScreenshots.push(newScreenshot);
      localStorage.setItem("websiteScreenshots", JSON.stringify(websiteScreenshots));
      
      // Sync with Firebase
      if (syncStatus === 'connected') {
        database.ref('websiteScreenshots').set(websiteScreenshots);
      }

      showNotif("âœ… Screenshot berhasil disimpan!");

      // Reset form
      document.getElementById('inlis-upload').value = '';
      document.getElementById('onesearch-upload').value = '';
      document.getElementById('screenshotPreviewContainer').innerHTML = '';

      // Kembali ke menu monitoring
      switchPage('pageMonitoringScreenshot', 'pageMonitoringMenu');
    };
    onearchReader.readAsDataURL(onearchFile);
  };
  inlisReader.readAsDataURL(inlisFile);
}

// ðŸ“Š Tampilkan History Screenshot
function loadScreenshotHistory() {
  const websiteScreenshots = JSON.parse(localStorage.getItem("websiteScreenshots")) || [];
  const container = document.getElementById("screenshotHistoryContainer");

  container.innerHTML = "";

  if (websiteScreenshots.length === 0) {
    container.innerHTML = '<div class="text-center py-8 text-gray-500">Belum ada data screenshot</div>';
    return;
  }

  // Sort by date (newest first)
  websiteScreenshots.sort((a, b) => new Date(b.date) - new Date(a.date));

  websiteScreenshots.forEach((item, index) => {
    const card = document.createElement("div");
    card.className = "screenshot-history-card animate-fadeInUp";
    card.style.animationDelay = `${index * 0.1}s`;

    card.innerHTML = `
    <div class="screenshot-history-header">
    <div>
    <h3 class="text-lg font-semibold">Screenshot #${websiteScreenshots.length - index}</h3>
    <p class="text-sm opacity-90">${formatDate(item.date)}</p>
    </div>
    <button onclick="deleteScreenshotHistory(${item.id})" class="btn btn-danger btn-sm">
    <i class="fas fa-trash"></i>
    </button>
    </div>
    <div class="screenshot-history-body">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
    <div>
    <h4 class="font-semibold text-gray-700 mb-2">
    <i class="fas fa-building text-info mr-2"></i>
    INLIS Perpustakaan
    </h4>
    <p class="text-sm text-gray-600 mb-2">${item.inlis.name}</p>
    <a href="https://inlis.perpusnas.go.id/" target="_blank" class="text-info text-sm hover:underline">
    https://inlis.perpusnas.go.id/
    </a>
    </div>
    <div>
    <h4 class="font-semibold text-gray-700 mb-2">
    <i class="fas fa-search text-warning mr-2"></i>
    ONESEARCH
    </h4>
    <p class="text-sm text-gray-600 mb-2">${item.onearch.name}</p>
    <a href="https://onesearch.id/" target="_blank" class="text-info text-sm hover:underline">
    https://onesearch.id/
    </a>
    </div>
    </div>
    <div class="screenshot-history-images">
    <div class="screenshot-history-image-container">
    <h4 class="font-semibold text-gray-700 mb-2">INLIS Screenshot</h4>
    <img src="${item.inlis.data}" alt="INLIS Screenshot" class="screenshot-history-image" onclick="openLightbox(0, ['${item.inlis.data}', '${item.onearch.data}'], ['INLIS Perpustakaan', 'ONESEARCH'])">
    <div class="screenshot-history-image-overlay">
    <span class="screenshot-history-image-title">INLIS Perpustakaan</span>
    <div class="screenshot-history-image-actions">
    <button class="screenshot-history-image-btn" onclick="openLightbox(0, ['${item.inlis.data}', '${item.onearch.data}'], ['INLIS Perpustakaan', 'ONESEARCH'])">
    <i class="fas fa-expand"></i>
    </button>
    <button class="screenshot-history-image-btn" onclick="downloadImage('${item.inlis.data}', '${item.inlis.name}')">
    <i class="fas fa-download"></i>
    </button>
    </div>
    </div>
    </div>
    </div>
    <div class="screenshot-history-image-container">
    <h4 class="font-semibold text-gray-700 mb-2">ONESEARCH Screenshot</h4>
    <img src="${item.onearch.data}" alt="ONESEARCH Screenshot" class="screenshot-history-image" onclick="openLightbox(1, ['${item.inlis.data}', '${item.onearch.data}'], ['INLIS Perpustakaan', 'ONESEARCH'])">
    <div class="screenshot-history-image-overlay">
    <span class="screenshot-history-image-title">ONESEARCH</span>
    <div class="screenshot-history-image-actions">
    <button class="screenshot-history-image-btn" onclick="openLightbox(1, ['${item.inlis.data}', '${item.onearch.data}'], ['INLIS Perpustakaan', 'ONESEARCH'])">
    <i class="fas fa-expand"></i>
    </button>
    <button class="screenshot-history-image-btn" onclick="downloadImage('${item.onearch.data}', '${item.onearch.name}')">
    <i class="fas fa-download"></i>
    </button>
    </div>
    </div>
    </div>
    </div>
    </div>
    </div>
    `;

    container.appendChild(card);
  });
}

// ðŸ—‘ï¸ Delete Screenshot History
function deleteScreenshotHistory(id) {
  if (confirm("Apakah Anda yakin ingin menghapus screenshot ini?")) {
    let websiteScreenshots = JSON.parse(localStorage.getItem("websiteScreenshots")) || [];
    websiteScreenshots = websiteScreenshots.filter(item => item.id !== id);
    localStorage.setItem("websiteScreenshots", JSON.stringify(websiteScreenshots));
    
    // Sync with Firebase
    if (syncStatus === 'connected') {
      database.ref('websiteScreenshots').set(websiteScreenshots);
    }
    
    loadScreenshotHistory();
    showNotif("âœ… Screenshot berhasil dihapus!");
  }
}

// ðŸ–¼ï¸ Lightbox Functions
function openLightbox(index, images, titles) {
  currentLightboxIndex = index;
  currentLightboxImages = images;

  const lightbox = document.getElementById('lightbox');
  const lightboxImage = document.getElementById('lightboxImage');
  const lightboxCaption = document.getElementById('lightboxCaption');

  lightboxImage.src = images[index];
  lightboxCaption.textContent = titles[index];

  // Show/hide navigation buttons
  const prevBtn = document.querySelector('.lightbox-prev');
  const nextBtn = document.querySelector('.lightbox-next');

  if (images.length <= 1) {
    prevBtn.style.display = 'none';
    nextBtn.style.display = 'none';
  } else {
    prevBtn.style.display = 'flex';
    nextBtn.style.display = 'flex';
  }

  lightbox.classList.add('active');
}

function closeLightbox() {
  const lightbox = document.getElementById('lightbox');
  lightbox.classList.remove('active');
}

function navigateLightbox(direction) {
  currentLightboxIndex += direction;

  // Handle wrap around
  if (currentLightboxIndex < 0) {
    currentLightboxIndex = currentLightboxImages.length - 1;
  } else if (currentLightboxIndex >= currentLightboxImages.length) {
    currentLightboxIndex = 0;
  }

  const lightboxImage = document.getElementById('lightboxImage');
  lightboxImage.src = currentLightboxImages[currentLightboxIndex];
}

// ðŸ“¥ Download Image
function downloadImage(dataUrl, filename) {
  const link = document.createElement('a');
  link.href = dataUrl;
  link.download = filename;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

// ðŸŒ Network Tasks
// Fungsi konversi file ke base64
function toBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () => resolve(reader.result);
    reader.onerror = (err) => reject(err);
  });
}

// Submit form network
async function submitNetworkForm() {
  const form = document.getElementById('monitoringForm');
  const formData = new FormData(form);
  const uploads = {};

  for (let [key, file] of formData.entries()) {
    if (file && file.size > 0) {
      uploads[key] = await toBase64(file);
    } else {
      uploads[key] = null;
    }
  }

  const history = JSON.parse(localStorage.getItem('networkHistory')) || [];
  const newEntry = {
    id: Date.now(),
    date: new Date().toLocaleString(),
    uploads,
    userId: JSON.parse(localStorage.getItem("activeUser")).username || JSON.parse(localStorage.getItem("activeUser")).email,
    createdAt: new Date().toISOString()
  };
  
  history.push(newEntry);
  localStorage.setItem('networkHistory', JSON.stringify(history));
  
  // Sync with Firebase
  if (syncStatus === 'connected') {
    database.ref('networkHistory').set(history);
  }
  
  showNotif('âœ… Data berhasil disimpan!');
  form.reset();
}

// Tampilkan halaman riwayat
function showHistory() {
  document.getElementById('monitoringPage').classList.add('hidden');
  document.getElementById('historyPage').classList.remove('hidden');
  loadHistory();
}

// Tampilkan halaman monitoring
function showMonitoring() {
  document.getElementById('historyPage').classList.add('hidden');
  document.getElementById('monitoringPage').classList.remove('hidden');
}

// Muat data riwayat
function loadHistory() {
  const tbody = document.getElementById('historyTable');
  tbody.innerHTML = '';
  const data = JSON.parse(localStorage.getItem('networkHistory')) || [];
  if (data.length === 0) {
    tbody.innerHTML = '<tr><td colspan="10" class="py-4 text-gray-600">Belum ada data riwayat</td></tr>';
    return;
  }

  // Sort by date (newest first)
  data.sort((a, b) => new Date(b.date) - new Date(a.date));

  data.forEach((item, index) => {
    const isCompleted = item.completed || false;
    const row = document.createElement('tr');
    row.classList.add('border-b');
    row.innerHTML = `
    <td class="px-4 py-2">${item.date}</td>
     ${createImageCell(item.uploads.google)}
     ${createImageCell(item.uploads.mersela)}
     ${createImageCell(item.uploads.salemba)}
     ${createImageCell(item.uploads.dns)}
     ${createImageCell(item.uploads.prtg)}
     ${createImageCell(item.uploads.lokal)}
     ${createImageCell(item.uploads.internasional)}
    <td>
    <span class="status-badge ${isCompleted ? 'success' : 'pending'}">
     ${isCompleted ? 'Selesai' : 'Pending'}
    </span>
    </td>
    <td>
    <button onclick="markNetworkCompleted(${index})" class="btn btn-success btn-sm">
    <i class="fas fa-check"></i>
    </button>
    </td>
    `;
    tbody.appendChild(row);
  });
}

// Buat cell gambar
function createImageCell(data) {
  if (data) {
    return `<td class="px-2 py-2"><img src="${data}" class="preview-img" onclick="openNetworkImageModal('${data.replace(/'/g, "\\'")}')"></td>`;
  } else {
    return `<td class="px-2 py-2 text-gray-400">â€”</td>`;
  }
}

// Modal gambar besar
function openNetworkImageModal(src) {
  const modal = document.getElementById("imageModal");
  const modalImage = document.getElementById("modalImage");
  modalImage.src = src;
  modal.classList.add("active");
}

// Hapus semua data riwayat
function clearHistory() {
  if (confirm('Yakin ingin menghapus semua riwayat?')) {
    localStorage.removeItem('networkHistory');
    
    // Sync with Firebase
    if (syncStatus === 'connected') {
      database.ref('networkHistory').set([]);
    }
    
    loadHistory();
    showNotif('âœ… Riwayat berhasil dihapus!');
  }
}

// ðŸ’¾ Simpan Rekap Log Harian
function submitRekapForm() {
  const data = {
    id: Date.now(),
    tanggal: document.getElementById('rekapTanggal').value,
    kegiatan: document.getElementById('rekapKegiatan').value,
    keterangan: document.getElementById('rekapKeterangan').value,
    userId: JSON.parse(localStorage.getItem("activeUser")).username || JSON.parse(localStorage.getItem("activeUser")).email,
    createdAt: new Date().toISOString()
  };

  if (!data.tanggal || !data.kegiatan) {
    showNotif("âš ï¸ Lengkapi data yang wajib diisi!", "error");
    return;
  }

  let rekapList = JSON.parse(localStorage.getItem("rekapList")) || [];
  rekapList.push(data);
  localStorage.setItem("rekapList", JSON.stringify(rekapList));
  
  // Sync with Firebase
  if (syncStatus === 'connected') {
    database.ref('rekapList').set(rekapList);
  }

  document.getElementById('rekapForm').reset();

  showNotif("âœ… Rekap log harian berhasil disimpan!");
  switchPage("pageRekapForm","pageRekap");
  loadRekapData();
}

// ðŸ“Š Tampilkan Data Rekap
function loadRekapData() {
  const rekapList = JSON.parse(localStorage.getItem("rekapList")) || [];
  const tableBody = document.getElementById("rekapTableBody");

  tableBody.innerHTML = "";

  if (rekapList.length === 0) {
    tableBody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-500">Belum ada data rekap log harian</td></tr>';
    return;
  }

  // Sort by date (newest first)
  rekapList.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));

  rekapList.forEach((item, index) => {
    const isCompleted = item.completed || false;
    const row = document.createElement("tr");
    row.innerHTML = `
    <td>${index + 1}</td>
    <td>${item.tanggal}</td>
    <td>${item.kegiatan}</td>
    <td>${item.keterangan || '-'}</td>
    <td>
    <span class="status-badge ${isCompleted ? 'success' : 'pending'}">
     ${isCompleted ? 'Selesai' : 'Pending'}
    </span>
    </td>
    <td>
    <button onclick="markRekapCompleted(${item.id})" class="btn btn-success btn-sm">
    <i class="fas fa-check"></i>
    </button>
    </td>
    `;
    tableBody.appendChild(row);
  });
}

// ðŸ–¼ï¸ Preview Image untuk Laporan
function previewLaporanImage(event) {
  const file = event.target.files[0];
  const preview = document.getElementById('laporanPreview');

  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      preview.innerHTML = `<img src="${e.target.result}" class="screenshot-preview" onclick="viewImage('${e.target.result}')" />`;
    }
    reader.readAsDataURL(file);
  }
}

// ðŸ’¾ Simpan Laporan Harian
function submitLaporanForm() {
  const fotoFile = document.getElementById('fotoDokumentasi').files[0];

  if (!fotoFile) {
    showNotif("âš ï¸ Upload foto dokumentasi kegiatan!", "error");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    const laporanList = JSON.parse(localStorage.getItem("laporanList")) || [];
    const newLaporan = {
      id: Date.now(),
      tanggal: document.getElementById('laporanTanggal').value,
      namaKegiatan: document.getElementById('namaKegiatan').value,
      deskripsiKegiatan: document.getElementById('deskripsiKegiatan').value,
      foto: e.target.result,
      userId: JSON.parse(localStorage.getItem("activeUser")).username || JSON.parse(localStorage.getItem("activeUser")).email,
      createdAt: new Date().toISOString()
    };
    
    laporanList.push(newLaporan);
    localStorage.setItem("laporanList", JSON.stringify(laporanList));
    
    // Sync with Firebase
    if (syncStatus === 'connected') {
      database.ref('laporanList').set(laporanList);
    }

    document.getElementById('laporanForm').reset();
    document.getElementById('laporanPreview').innerHTML = '';

    showNotif("âœ… Laporan harian berhasil disimpan!");
    switchPage("pageLaporanForm","pageLaporan");
  }
  reader.readAsDataURL(fotoFile);
}

// ðŸ“Š Tampilkan History Laporan
function loadLaporanHistory() {
  const laporanList = JSON.parse(localStorage.getItem("laporanList")) || [];
  const tableBody = document.getElementById("laporanHistoryTableBody");

  tableBody.innerHTML = "";

  if (laporanList.length === 0) {
    tableBody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-500">Belum ada data laporan harian</td></tr>';
    return;
  }

  // Sort by date (newest first)
  laporanList.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));

  laporanList.forEach((item, index) => {
    const isCompleted = item.completed || false;
    const row = document.createElement("tr");
    row.innerHTML = `
    <td>${index + 1}</td>
    <td>${item.namaKegiatan}</td>
    <td>${item.tanggal}</td>
    <td>
    <span class="status-badge ${isCompleted ? 'success' : 'pending'}">
     ${isCompleted ? 'Selesai' : 'Pending'}
    </span>
    </td>
    <td>
    <button onclick="viewLaporanDetail(${item.id})" class="btn btn-secondary btn-sm">
    <i class="fas fa-eye"></i>
    </button>
    <button onclick="markLaporanCompleted(${item.id})" class="btn btn-success btn-sm">
    <i class="fas fa-check"></i>
    </button>
    <button onclick="deleteLaporan(${item.id})" class="btn btn-danger btn-sm">
    <i class="fas fa-trash"></i>
    </button>
    </td>
    `;
    tableBody.appendChild(row);
  });
}

// ðŸ“„ View Laporan Detail
function viewLaporanDetail(id) {
  const laporanList = JSON.parse(localStorage.getItem("laporanList")) || [];
  const laporan = laporanList.find(item => item.id === id);

  if (!laporan) {
    showNotif("âš ï¸ Laporan tidak ditemukan!", "error");
    return;
  }

  // Create a modal to display the report details
  const modal = document.createElement('div');
  modal.className = 'modal active';
  modal.innerHTML = `
  <div class="modal-content">
  <button class="modal-close" onclick="this.closest('.modal').remove()">
  <i class="fas fa-times"></i>
  </button>
  <h2 class="text-2xl font-bold text-gray-800 mb-6">Detail Laporan</h2>
  <div class="space-y-4">
  <div>
  <h3 class="text-lg font-semibold text-gray-700">Tanggal</h3>
  <p class="text-gray-600">${laporan.tanggal}</p>
  </div>
  <div>
  <h3 class="text-lg font-semibold text-gray-700">Nama Kegiatan</h3>
  <p class="text-gray-600">${laporan.namaKegiatan}</p>
  </div>
  <div>
  <h3 class="text-lg font-semibold text-gray-700">Deskripsi Kegiatan</h3>
  <p class="text-gray-600">${laporan.deskripsiKegiatan}</p>
  </div>
  <div>
  <h3 class="text-lg font-semibold text-gray-700">Foto Dokumentasi</h3>
  <img src="${laporan.foto}" alt="Dokumentasi" class="w-full rounded-lg cursor-pointer" onclick="viewImage('${laporan.foto}')">
  </div>
  </div>
  </div>
  `;
  document.body.appendChild(modal);
}

// ðŸ—‘ï¸ Delete Laporan
function deleteLaporan(id) {
  if (confirm("Apakah Anda yakin ingin menghapus laporan ini?")) {
    let laporanList = JSON.parse(localStorage.getItem("laporanList")) || [];
    laporanList = laporanList.filter(item => item.id !== id);
    localStorage.setItem("laporanList", JSON.stringify(laporanList));
    
    // Sync with Firebase
    if (syncStatus === 'connected') {
      database.ref('laporanList').set(laporanList);
    }
    
    loadLaporanHistory();
    showNotif("âœ… Laporan berhasil dihapus!");
  }
}

// ðŸ–¼ï¸ View Image in Modal
function viewImage(imageSrc) {
  const modal = document.getElementById("imageModal");
  const modalImage = document.getElementById("modalImage");
  modalImage.src = imageSrc;
  modal.classList.add("active");
}

// âŒ Close Image Modal
function closeImageModal() {
  const modal = document.getElementById("imageModal");
  modal.classList.remove("active");
}

// ðŸ“… Format Date
function formatDate(dateString) {
  const date = new Date(dateString);
  const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
  const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];

  return `${days[date.getDay()]}, ${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
}

// Scroll to top
function goToTop() {
  window.scrollTo({
    top: 0,
    behavior: 'smooth'
  });
}

// ==================== TASK MANAGEMENT FUNCTIONS ====================

// ðŸ“‹ Open Task Modal
function openTaskModal(taskId = null) {
  currentEditingTask = taskId;
  const modal = document.getElementById('taskModal');
  const form = document.getElementById('taskForm');

  // Populate student dropdown
  const users = JSON.parse(localStorage.getItem("users")) || [];
  const assignToSelect = document.getElementById('taskAssignTo');
  assignToSelect.innerHTML = '<option value="">Pilih Siswa</option>';
  users.forEach(user => {
    const option = document.createElement('option');
    option.value = user.username;
    option.textContent = user.name || user.username;
    assignToSelect.appendChild(option);
  });

  if (taskId) {
    // Edit mode - load existing task
    const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
    const task = tasks.find(t => t.id === taskId);
    if (task) {
      document.getElementById('taskModalTitle').textContent = 'Edit Tugas';
      document.getElementById('taskTitle').value = task.title;
      document.getElementById('taskDescription').value = task.description;
      document.getElementById('taskDeadline').value = task.deadline;
      document.getElementById('taskMaxPoints').value = task.maxPoints;
      document.getElementById('taskAssignTo').value = task.assignTo;
    }
  } else {
    // Add new task mode
    document.getElementById('taskModalTitle').textContent = 'Tambah Tugas';
    form.reset();
  }

  modal.classList.add('active');
}

// âŒ Close Task Modal
function closeTaskModal() {
  const modal = document.getElementById('taskModal');
  modal.classList.remove('active');
  currentEditingTask = null;
}

// ðŸ’¾ Save Task
function saveTask() {
  const title = document.getElementById('taskTitle').value.trim();
  const description = document.getElementById('taskDescription').value.trim();
  const deadline = document.getElementById('taskDeadline').value;
  const maxPoints = parseInt(document.getElementById('taskMaxPoints').value);
  const assignTo = document.getElementById('taskAssignTo').value;

  if (!title || !description || !deadline || !assignTo) {
    showNotif("âš ï¸ Lengkapi semua field yang wajib diisi!", "error");
    return;
  }

  let tasks = JSON.parse(localStorage.getItem("tasks")) || [];

  if (currentEditingTask) {
    // Update existing task
    const taskIndex = tasks.findIndex(t => t.id === currentEditingTask);
    if (taskIndex !== -1) {
      tasks[taskIndex] = {
        ...tasks[taskIndex],
        title,
        description,
        deadline,
        maxPoints,
        assignTo,
        updatedAt: new Date().toISOString()
      };
    }
  } else {
    // Add new task
    const newTask = {
      id: Date.now(),
      title,
      description,
      deadline,
      maxPoints,
      assignTo,
      status: 'pending',
      grade: null,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    };
    tasks.push(newTask);
  }

  localStorage.setItem("tasks", JSON.stringify(tasks));
  
  // Sync with Firebase
  if (syncStatus === 'connected') {
    database.ref('tasks').set(tasks);
  }
  
  closeTaskModal();
  loadTasksList();
  loadStudentTasks();
  showNotif(`âœ… Tugas berhasil ${currentEditingTask ? 'diperbarui' : 'ditambahkan'}!`);

  // Notify student if they are logged in
  notifyStudentOfNewTask(assignTo, title);
}

// ðŸ“‹ Load Tasks List (Guru View)
function loadTasksList() {
  const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
  const tasksList = document.getElementById("tasksList");

  tasksList.innerHTML = "";

  if (tasks.length === 0) {
    tasksList.innerHTML = '<p class="text-center text-gray-500 py-8">Belum ada tugas</p>';
    return;
  }

  // Sort by creation date (newest first)
  tasks.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

  tasks.forEach(task => {
    const taskCard = createTaskCard(task);
    tasksList.appendChild(taskCard);
  });
}

// ðŸŽ¯ Create Task Card
function createTaskCard(task) {
  const card = document.createElement('div');
  const isOverdue = new Date(task.deadline) < new Date() && task.status !== 'completed';

  let statusClass = 'pending';
  if (task.status === 'completed') statusClass = 'completed';
  else if (isOverdue) statusClass = 'overdue';

  card.className = `task-card ${statusClass}`;

  const gradeBadge = task.grade ? getGradeBadge(task.grade, task.maxPoints) : '';

  card.innerHTML = `
  <div class="flex justify-between items-start mb-4">
  <div class="flex-1">
  <h4 class="text-lg font-semibold text-gray-800 mb-2">${task.title}</h4>
  <p class="text-gray-600 mb-2">${task.description}</p>
  <div class="flex flex-wrap gap-2 text-sm">
  <span class="text-gray-500">
  <i class="fas fa-user mr-1"></i>${task.assignTo}
  </span>
  <span class="text-gray-500">
  <i class="fas fa-calendar mr-1"></i>${formatDate(task.deadline)}
  </span>
  <span class="text-gray-500">
  <i class="fas fa-star mr-1"></i>${task.maxPoints} poin
  </span>
  </div>
  </div>
  <div class="flex gap-2">
   ${gradeBadge}
  <button onclick="openTaskModal(${task.id})" class="btn btn-secondary btn-sm">
  <i class="fas fa-edit"></i>
  </button>
  <button onclick="deleteTask(${task.id})" class="btn btn-danger btn-sm">
  <i class="fas fa-trash"></i>
  </button>
  </div>
  </div>
   ${task.status === 'pending' ? `
  <div class="flex items-center gap-4">
  <label class="text-sm font-semibold text-gray-700">Nilai:</label>
  <input type="number"
  class="grade-input"
  min="0"
  max="${task.maxPoints}"
  value="${task.grade || ''}"
  placeholder="0-${task.maxPoints}"
  onchange="updateTaskGrade(${task.id}, this.value)">
  <button onclick="markTaskCompleted(${task.id})" class="btn btn-success btn-sm">
  <i class="fas fa-check"></i>
  Tandai Selesai
  </button>
  </div>
  ` : `
  <div class="flex items-center gap-2">
  <span class="status-badge success">
  <i class="fas fa-check-circle mr-1"></i>
  Selesai
  </span>
   ${task.grade ? `
  <span class="grade-badge ${getGradeClass(task.grade, task.maxPoints)}">
   ${task.grade}/${task.maxPoints}
  </span>
  ` : ''}
  </div>
  `}
  `;

  return card;
}

// ðŸ† Get Grade Badge
function getGradeBadge(grade, maxPoints) {
  const percentage = (grade / maxPoints) * 100;
  const gradeClass = getGradeClass(grade, maxPoints);
  return `<span class="grade-badge ${gradeClass}">${grade}/${maxPoints}</span>`;
}

// ðŸ† Get Grade Class
function getGradeClass(grade, maxPoints) {
  const percentage = (grade / maxPoints) * 100;
  if (percentage >= 90) return 'excellent';
  if (percentage >= 75) return 'good';
  if (percentage >= 60) return 'average';
  return 'poor';
}

// âœï¸ Update Task Grade
function updateTaskGrade(taskId, grade) {
  const gradeValue = parseInt(grade);
  if (isNaN(gradeValue) || gradeValue < 0) return;

  let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
  const taskIndex = tasks.findIndex(t => t.id === taskId);

  if (taskIndex !== -1) {
    tasks[taskIndex].grade = gradeValue;
    tasks[taskIndex].updatedAt = new Date().toISOString();
    localStorage.setItem("tasks", JSON.stringify(tasks));
    
    // Sync with Firebase
    if (syncStatus === 'connected') {
      database.ref('tasks').set(tasks);
    }
    
    loadTasksList();
    loadStudentTasks();
    showNotif("âœ… Nilai berhasil diperbarui!");
    
    // Notify student of grade update
    const task = tasks[taskIndex];
    notifyStudentOfGradeUpdate(task.assignTo, task.title, gradeValue, task.maxPoints);
  }
}

// âœ… Mark Task as Completed
function markTaskCompleted(taskId) {
  let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
  const taskIndex = tasks.findIndex(t => t.id === taskId);

  if (taskIndex !== -1) {
    tasks[taskIndex].status = 'completed';
    tasks[taskIndex].completedAt = new Date().toISOString();
    tasks[taskIndex].updatedAt = new Date().toISOString();
    localStorage.setItem("tasks", JSON.stringify(tasks));
    
    // Sync with Firebase
    if (syncStatus === 'connected') {
      database.ref('tasks').set(tasks);
    }
    
    loadTasksList();
    loadStudentTasks();
    showNotif("âœ… Tugas ditandai sebagai selesai!");
    
    // Notify student of task completion
    const task = tasks[taskIndex];
    notifyStudentOfTaskCompletion(task.assignTo, task.title);
  }
}

// ðŸ—‘ï¸ Delete Task
function deleteTask(taskId) {
  if (confirm("Apakah Anda yakin ingin menghapus tugas ini?")) {
    let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
    tasks = tasks.filter(t => t.id !== taskId);
    localStorage.setItem("tasks", JSON.stringify(tasks));
    
    // Sync with Firebase
    if (syncStatus === 'connected') {
      database.ref('tasks').set(tasks);
    }
    
    loadTasksList();
    loadStudentTasks();
    showNotif("âœ… Tugas berhasil dihapus!");
  }
}

// ðŸ“‹ Load Student Tasks (Siswa View)
function loadStudentTasks() {
  const activeUser = JSON.parse(localStorage.getItem("activeUser"));
  if (!activeUser) return;

  const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
  const studentTasks = tasks.filter(t => t.assignTo === activeUser.username || t.assignTo === activeUser.email);
  const studentTasksList = document.getElementById("studentTasksList");

  if (!studentTasksList) return; // Exit if element doesn't exist on current page

  studentTasksList.innerHTML = "";

  if (studentTasks.length === 0) {
    studentTasksList.innerHTML = '<p class="text-center text-gray-500 py-8">Belum ada tugas untuk Anda</p>';
    return;
  }

  studentTasks.forEach(task => {
    const taskCard = createStudentTaskCard(task);
    studentTasksList.appendChild(taskCard);
  });
  
  // Update task count
  updateTaskCount();
}

// ðŸŽ¯ Create Student Task Card
function createStudentTaskCard(task) {
  const card = document.createElement('div');
  const isOverdue = new Date(task.deadline) < new Date() && task.status !== 'completed';

  let statusClass = 'pending';
  if (task.status === 'completed') statusClass = 'completed';
  else if (isOverdue) statusClass = 'overdue';

  card.className = `task-card ${statusClass}`;

  const gradeBadge = task.grade ? getGradeBadge(task.grade, task.maxPoints) : '';

  card.innerHTML = `
  <div class="flex justify-between items-start mb-4">
  <div class="flex-1">
  <h4 class="text-lg font-semibold text-gray-800 mb-2">${task.title}</h4>
  <p class="text-gray-600 mb-2">${task.description}</p>
  <div class="flex flex-wrap gap-2 text-sm">
  <span class="text-gray-500">
  <i class="fas fa-calendar mr-1"></i>Deadline: ${formatDate(task.deadline)}
  </span>
  <span class="text-gray-500">
  <i class="fas fa-star mr-1"></i>${task.maxPoints} poin
  </span>
  </div>
  </div>
   ${gradeBadge}
  </div>
  <div class="flex items-center gap-2">
   ${task.status === 'completed' ? `
  <span class="status-badge success">
  <i class="fas fa-check-circle mr-1"></i>
  Selesai
  </span>
   ${task.completedAt ? `
  <span class="text-sm text-gray-500">
  Selesai: ${formatDate(task.completedAt)}
  </span>
  ` : ''}
  ` : isOverdue ? `
  <span class="status-badge warning">
  <i class="fas fa-exclamation-triangle mr-1"></i>
  Terlambat
  </span>
  ` : `
  <span class="status-badge info">
  <i class="fas fa-clock mr-1"></i>
  Pending
  </span>
  `}
  </div>
  <div class="mt-4">
  <button onclick="viewTaskDetail(${task.id})" class="btn btn-primary w-full">
  <i class="fas fa-eye"></i>
  Lihat Detail & Kerjakan
  </button>
  </div>
  `;

  return card;
}

// ðŸ“‹ Open Task Detail Modal
function viewTaskDetail(taskId) {
  currentViewingTask = taskId;
  const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
  const task = tasks.find(t => t.id === taskId);
  
  if (!task) {
    showNotif("âš ï¸ Tugas tidak ditemukan!", "error");
    return;
  }
  
  const modal = document.getElementById('taskDetailModal');
  const content = document.getElementById('taskDetailContent');
  
  // Check if task has been submitted
  const taskSubmissions = JSON.parse(localStorage.getItem("taskSubmissions")) || [];
  const submission = taskSubmissions.find(s => s.taskId === taskId);
  
  content.innerHTML = `
  <div class="space-y-4">
  <div>
  <h3 class="text-lg font-semibold text-gray-700">Judul Tugas</h3>
  <p class="text-gray-600">${task.title}</p>
  </div>
  <div>
  <h3 class="text-lg font-semibold text-gray-700">Deskripsi</h3>
  <p class="text-gray-600">${task.description}</p>
  </div>
  <div>
  <h3 class="text-lg font-semibold text-gray-700">Deadline</h3>
  <p class="text-gray-600">${formatDate(task.deadline)}</p>
  </div>
  <div>
  <h3 class="text-lg font-semibold text-gray-700">Poin Maksimal</h3>
  <p class="text-gray-600">${task.maxPoints} poin</p>
  </div>
  
   ${task.status === 'completed' ? `
  <div class="bg-green-50 p-4 rounded-lg">
  <h3 class="text-lg font-semibold text-green-800 mb-2">Status: Selesai</h3>
   ${task.grade ? `
  <p class="text-green-800">Nilai: ${task.grade}/${task.maxPoints}</p>
  ` : ''}
   ${task.completedAt ? `
  <p class="text-green-800">Diselesaikan: ${formatDate(task.completedAt)}</p>
  ` : ''}
  </div>
  ` : submission ? `
  <div class="bg-blue-50 p-4 rounded-lg">
  <h3 class="text-lg font-semibold text-blue-800 mb-2">Status: Telah Dikumpulkan</h3>
  <p class="text-blue-800">Dikumpulkan: ${formatDate(submission.submittedAt)}</p>
  <div class="mt-2">
  <p class="text-blue-800 font-semibold">Jawaban:</p>
  <p class="text-gray-700 bg-white p-2 rounded">${submission.answer}</p>
  </div>
   ${submission.files && submission.files.length > 0 ? `
  <div class="mt-2">
  <p class="text-blue-800 font-semibold">File Terlampir:</p>
  <div class="space-y-2 mt-2">
   ${submission.files.map((file, index) => `
  <div class="flex items-center justify-between bg-white p-2 rounded border">
  <div class="flex items-center">
  <i class="fas fa-file text-gray-400 mr-2"></i>
  <div>
  <p class="text-sm font-medium text-gray-700">${file.name}</p>
  <p class="text-xs text-gray-500">${formatFileSize(file.size)}</p>
  </div>
  </div>
  <div class="flex gap-2">
   ${file.type.startsWith('image/') ? `
  <button onclick="viewSubmissionFile('${file.data}')" class="btn btn-secondary btn-sm">
  <i class="fas fa-eye"></i>
  </button>
  ` : ''}
  <button onclick="downloadSubmissionFile('${file.data}', '${file.name}')" class="btn btn-secondary btn-sm">
  <i class="fas fa-download"></i>
  </button>
  </div>
  </div>
  `).join('')}
  </div>
  </div>
  ` : ''}
  </div>
  ` : `
  <div class="task-submission">
  <h3 class="text-lg font-semibold text-gray-700 mb-2">Kumpulkan Tugas</h3>
  <textarea id="taskAnswer" class="task-submission-textarea" placeholder="Tulis jawaban atau deskripsi pekerjaan Anda..."></textarea>
  
  <div class="task-submission-files">
  <div class="flex items-center gap-2 mb-2">
  <label for="taskFileInput" class="btn btn-secondary btn-sm">
  <i class="fas fa-paperclip"></i>
  Lampirkan File (Foto, PDF, Dokumen, dll)
  </label>
  <input type="file" id="taskFileInput" class="hidden" multiple onchange="handleTaskFileSelect(event)" accept="image/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx">
  </div>
  </div>
  
  <div id="taskFilesList" class="space-y-2">
  <!-- Selected files will be listed here -->
  </div>
  </div>
  
  <div class="flex justify-end gap-2 mt-4">
  <button onclick="closeTaskDetailModal()" class="btn btn-secondary">
  Batal
  </button>
  <button onclick="submitTaskWork()" class="btn btn-primary">
  <i class="fas fa-paper-plane"></i>
  Kirim Tugas
  </button>
  </div>
  `}
  </div>
  `;
  
  modal.classList.add('active');
}

// âŒ Close Task Detail Modal
function closeTaskDetailModal() {
  const modal = document.getElementById('taskDetailModal');
  modal.classList.remove('active');
  currentViewingTask = null;
  taskSubmissionFiles = [];
}

// ðŸ“‹ Handle Task File Selection
function handleTaskFileSelect(event) {
  const files = event.target.files;
  const filesList = document.getElementById('taskFilesList');
  
  // Convert FileList to array and add to our global array
  for (let i = 0; i < files.length; i++) {
    const file = files[i];
    taskSubmissionFiles.push(file);
  }
  
  // Update the UI to show selected files
  updateTaskFilesList();
}

// ðŸ”„ Update Task Files List UI
function updateTaskFilesList() {
  const filesList = document.getElementById('taskFilesList');
  
  if (taskSubmissionFiles.length === 0) {
    filesList.innerHTML = '<p class="text-gray-500 text-sm">Tidak ada file yang dipilih</p>';
    return;
  }
  
  filesList.innerHTML = taskSubmissionFiles.map((file, index) => `
  <div class="task-submission-file-item">
  <span class="task-submission-file-name">
  <i class="fas fa-file mr-2"></i>${file.name}
  <span class="text-xs text-gray-500">(${formatFileSize(file.size)})</span>
  </span>
  <span class="task-submission-file-remove" onclick="removeTaskFile(${index})">
  <i class="fas fa-times"></i>
  </span>
  </div>
  `).join('');
}

// ðŸ—‘ï¸ Remove Task File
function removeTaskFile(index) {
  taskSubmissionFiles.splice(index, 1);
  updateTaskFilesList();
}

// ðŸ“¤ Submit Task Work
async function submitTaskWork() {
  const answer = document.getElementById('taskAnswer').value.trim();
  
  if (!answer) {
    showNotif("âš ï¸ Jawaban tidak boleh kosong!", "error");
    return;
  }
  
  // Convert files to base64 for storage
  const filesData = [];
  for (const file of taskSubmissionFiles) {
    const base64 = await fileToBase64(file);
    filesData.push({
      name: file.name,
      type: file.type,
      size: file.size,
      data: base64
    });
  }
  
  // Save submission
  const taskSubmissions = JSON.parse(localStorage.getItem("taskSubmissions")) || [];
  const newSubmission = {
    taskId: currentViewingTask,
    answer,
    files: filesData,
    submittedAt: new Date().toISOString()
  };
  
  taskSubmissions.push(newSubmission);
  localStorage.setItem("taskSubmissions", JSON.stringify(taskSubmissions));
  
  // Sync with Firebase
  if (syncStatus === 'connected') {
    database.ref('taskSubmissions').set(taskSubmissions);
  }
  
  // Update task status
  let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
  const taskIndex = tasks.findIndex(t => t.id === currentViewingTask);
  
  if (taskIndex !== -1) {
    tasks[taskIndex].status = 'submitted';
    tasks[taskIndex].submittedAt = new Date().toISOString();
    localStorage.setItem("tasks", JSON.stringify(tasks));
    
    // Sync with Firebase
    if (syncStatus === 'connected') {
      database.ref('tasks').set(tasks);
    }
  }
  
  closeTaskDetailModal();
  loadStudentTasks();
  loadMenuTasks();
  showNotif("âœ… Tugas berhasil dikumpulkan! Menunggu penilaian dari guru.");
}

// ðŸ”” Convert File to Base64
function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () => resolve(reader.result);
    reader.onerror = error => reject(error);
  });
}

// ðŸ”” Notify Student of New Task
function notifyStudentOfNewTask(username, taskTitle) {
  // Check if the student is currently logged in
  const activeUser = JSON.parse(localStorage.getItem("activeUser"));
  if (activeUser && (activeUser.username === username || activeUser.email === username)) {
    // Show notification to the student
    showNotif(`ðŸ“‹ Tugas baru: "${taskTitle}"`, "info");
    
    // Check current page and update appropriate task list
    const currentPage = getCurrentPage();
    
    if (currentPage === 'page2') {
      // If on main dashboard, reload student tasks
      loadStudentTasks();
    } else if (currentPage === 'page2Menu') {
      // If on menu page, reload menu tasks
      loadMenuTasks();
    }
    
    // Always update the task count in both dashboard and menu
    updateTaskCount();
    updateMenuTaskCount();
  }
  
  // Add notification to database
  addNotification(
    username,
    "Tugas Baru",
    `Anda memiliki tugas baru: "${taskTitle}"`,
    "info"
  );
}

// ðŸ”” Notify Student of Grade Update
function notifyStudentOfGradeUpdate(username, taskTitle, grade, maxPoints) {
  // Check if the student is currently logged in
  const activeUser = JSON.parse(localStorage.getItem("activeUser"));
  if (activeUser && (activeUser.username === username || activeUser.email === username)) {
    // Show notification to the student
    showNotif(`ðŸ“Š Tugas "${taskTitle}" telah dinilai: ${grade}/${maxPoints}`, "success");
    
    // Check current page and update appropriate task list
    const currentPage = getCurrentPage();
    
    if (currentPage === 'page2') {
      // If on main dashboard, reload student tasks
      loadStudentTasks();
    } else if (currentPage === 'page2Menu') {
      // If on menu page, reload menu tasks
      loadMenuTasks();
    }
  }
  
  // Add notification to database
  addNotification(
    username,
    "Tugas Dinilai",
    `Tugas "${taskTitle}" telah dinilai: ${grade}/${maxPoints}`,
    "success"
  );
}

// ðŸ”” Notify Student of Task Completion
function notifyStudentOfTaskCompletion(username, taskTitle) {
  // Check if the student is currently logged in
  const activeUser = JSON.parse(localStorage.getItem("activeUser"));
  if (activeUser && (activeUser.username === username || activeUser.email === username)) {
    // Show notification to the student
    showNotif(`âœ… Tugas "${taskTitle}" telah ditandai sebagai selesai`, "success");
    
    // Check current page and update appropriate task list
    const currentPage = getCurrentPage();
    
    if (currentPage === 'page2') {
      // If on main dashboard, reload student tasks
      loadStudentTasks();
    } else if (currentPage === 'page2Menu') {
      // If on menu page, reload menu tasks
      loadMenuTasks();
    }
  }
  
  // Add notification to database
  addNotification(
    username,
    "Tugas Selesai",
    `Tugas "${taskTitle}" telah ditandai sebagai selesai`,
    "success"
  );
}

// ðŸ” Get Current Page
function getCurrentPage() {
  const pages = ['page1', 'pageLogin', 'pageGuruLogin', 'pageRegister', 'page2', 
  'page2Menu', 'pageAbsen', 'pageMonitoringMenu', 'pageMonitoringForm',
  'pageMonitoringScreenshot', 'pageMonitoringHistory', 'pageScreenshotHistory',
  'pageNetwork', 'pageRekap', 'pageRekapForm', 'pageLaporan', 
  'pageLaporanForm', 'pageLaporanHistory', 'pageProfil', 'pageGuruDashboard',
  'pageStudentDetail'];
  
  for (const pageId of pages) {
    const page = document.getElementById(pageId);
    if (page && page.style.display !== 'none') {
      return pageId;
    }
  }
  
  return null;
}

// ðŸ”„ Update Task Count (Dashboard)
function updateTaskCount() {
  const taskCount = document.getElementById('taskCount');
  if (taskCount) {
    // Hitung total tugas dari semua kategori
    const absenList = JSON.parse(localStorage.getItem("absenList")) || [];
    const monitoringList = JSON.parse(localStorage.getItem("monitoringList")) || [];
    const networkHistory = JSON.parse(localStorage.getItem("networkHistory")) || [];
    const rekapList = JSON.parse(localStorage.getItem("rekapList")) || [];
    const laporanList = JSON.parse(localStorage.getItem("laporanList")) || [];
    const websiteScreenshots = JSON.parse(localStorage.getItem("websiteScreenshots")) || [];
    
    // Get tasks assigned to current user
    const activeUser = JSON.parse(localStorage.getItem("activeUser"));
    const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
    const userTasks = activeUser ? tasks.filter(t => t.assignTo === activeUser.username || t.assignTo === activeUser.email) : [];
    
    const totalTasks = absenList.length + monitoringList.length + networkHistory.length + 
    rekapList.length + laporanList.length + websiteScreenshots.length + userTasks.length;
    taskCount.textContent = totalTasks.toString().padStart(2, '0');
  }
}

// ðŸ”„ Update Menu Task Count
function updateMenuTaskCount() {
  const taskCount = document.getElementById('menuTaskCount');
  if (taskCount) {
    const activeUser = JSON.parse(localStorage.getItem("activeUser"));
    if (!activeUser) return;

    const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
    const userTasks = tasks.filter(t => t.assignTo === activeUser.username || t.assignTo === activeUser.email);
    const pendingTasks = userTasks.filter(t => t.status !== 'completed');
    
    taskCount.textContent = pendingTasks.length.toString().padStart(2, '0');
  }
}

// ðŸ”„ Update Profile Page
function updateProfilePage() {
  const activeUser = JSON.parse(localStorage.getItem("activeUser"));
  if (!activeUser) return;
  
  // Update profile information
  displayUserData(activeUser);
  
  // Update task count
  updateTaskCount();
  
  // Note: We don't load tasks here as they should be on the main dashboard or menu
}

// ðŸ“‹ Load Tasks in Menu Page
function loadMenuTasks() {
  const activeUser = JSON.parse(localStorage.getItem("activeUser"));
  if (!activeUser) return;

  const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
  const studentTasks = tasks.filter(t => t.assignTo === activeUser.username || t.assignTo === activeUser.email);
  const menuTasksList = document.getElementById("menuTasksList");

  if (!menuTasksList) return; // Exit if element doesn't exist on current page

  menuTasksList.innerHTML = "";

  if (studentTasks.length === 0) {
    menuTasksList.innerHTML = '<p class="text-center text-gray-500 py-8">Belum ada tugas untuk Anda</p>';
    return;
  }

  // Sort tasks by deadline (earliest first)
  studentTasks.sort((a, b) => new Date(a.deadline) - new Date(b.deadline));

  // Show only first 3 tasks in menu
  const displayTasks = studentTasks.slice(0, 3);

  displayTasks.forEach(task => {
    const taskCard = createMenuTaskCard(task);
    menuTasksList.appendChild(taskCard);
  });

  // Show "View All" button if there are more than 3 tasks
  if (studentTasks.length > 3) {
    const viewAllBtn = document.createElement('div');
    viewAllBtn.className = 'text-center mt-4';
    viewAllBtn.innerHTML = `
    <button onclick="switchPage('page2Menu','page2')" class="btn btn-primary">
    <i class="fas fa-list"></i>
    Lihat Semua Tugas (${studentTasks.length})
    </button>
    `;
    menuTasksList.appendChild(viewAllBtn);
  }

  // Update task count
  updateMenuTaskCount();
}

// ðŸŽ¯ Create Menu Task Card (Enhanced version with file and grade info)
function createMenuTaskCard(task) {
  const card = document.createElement('div');
  const isOverdue = new Date(task.deadline) < new Date() && task.status !== 'completed';

  let statusClass = 'pending';
  if (task.status === 'completed') statusClass = 'completed';
  else if (isOverdue) statusClass = 'overdue';

  card.className = `task-card ${statusClass}`;

  const gradeBadge = task.grade ? getGradeBadge(task.grade, task.maxPoints) : '';
  
  // Check if task has submissions
  const taskSubmissions = JSON.parse(localStorage.getItem("taskSubmissions")) || [];
  const submission = taskSubmissions.find(s => s.taskId === task.id);
  const hasFiles = submission && submission.files && submission.files.length > 0;

  card.innerHTML = `
  <div class="flex justify-between items-start">
  <div class="flex-1">
  <h4 class="text-lg font-semibold text-gray-800 mb-1">${task.title}</h4>
  <p class="text-sm text-gray-600 mb-2">${task.description.substring(0, 50)}${task.description.length > 50 ? '...' : ''}</p>
  <div class="flex items-center gap-4 text-sm">
  <span class="text-gray-500">
  <i class="fas fa-calendar mr-1"></i>${formatDate(task.deadline)}
  </span>
  <span class="text-gray-500">
  <i class="fas fa-star mr-1"></i>${task.maxPoints} poin
  </span>
   ${hasFiles ? `
  <span class="text-blue-500">
  <i class="fas fa-paperclip mr-1"></i>${submission.files.length} file
  </span>
  ` : ''}
  </div>
  </div>
  <div class="flex flex-col items-end gap-2">
   ${gradeBadge}
   ${task.status === 'completed' ? `
  <span class="status-badge success">
  <i class="fas fa-check-circle mr-1"></i>
  Selesai
  </span>
  ` : isOverdue ? `
  <span class="status-badge warning">
  <i class="fas fa-exclamation-triangle mr-1"></i>
  Terlambat
  </span>
  ` : task.status === 'submitted' ? `
  <span class="status-badge info">
  <i class="fas fa-hourglass-half mr-1"></i>
  Dinilai
  </span>
  ` : `
  <span class="status-badge info">
  <i class="fas fa-clock mr-1"></i>
  Pending
  </span>
  `}
  <button onclick="viewTaskDetail(${task.id})" class="btn btn-primary btn-sm">
  <i class="fas fa-eye"></i>
  </button>
  </div>
  </div>
  `;

  return card;
}

// ðŸ‘ï¸ View Submission File
function viewSubmissionFile(fileData) {
  const modal = document.createElement('div');
  modal.className = 'modal active';
  modal.innerHTML = `
  <div class="modal-content max-w-4xl">
  <button class="modal-close" onclick="this.closest('.modal').remove()">
  <i class="fas fa-times"></i>
  </button>
  <img src="${fileData}" class="w-full rounded-lg" alt="File Preview">
  </div>
  `;
  document.body.appendChild(modal);
}

// ðŸ“¥ Download Submission File
function downloadSubmissionFile(fileData, fileName) {
  const link = document.createElement('a');
  link.href = fileData;
  link.download = fileName;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

// ðŸ“ Format File Size
function formatFileSize(bytes) {
  if (bytes === 0) return '0 Bytes';
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// ==================== TASK COMPLETION FUNCTIONS ====================

// âœ… Mark Monitoring Data as Completed
function markMonitoringCompleted(id) {
  let monitoringList = JSON.parse(localStorage.getItem("monitoringList")) || [];
  const itemIndex = monitoringList.findIndex(item => item.id === id);
  if (itemIndex !== -1) {
    monitoringList[itemIndex].completed = true;
    monitoringList[itemIndex].completedAt = new Date().toISOString();
    localStorage.setItem("monitoringList", JSON.stringify(monitoringList));
    
    // Sync with Firebase
    if (syncStatus === 'connected') {
      database.ref('monitoringList').set(monitoringList);
    }
    
    loadMonitoringHistory();
    showNotif("âœ… Monitoring data ditandai sebagai selesai!");
  }
}

// âœ… Mark Network Data as Completed
function markNetworkCompleted(index) {
  let networkHistory = JSON.parse(localStorage.getItem("networkHistory")) || [];
  if (networkHistory[index]) {
    networkHistory[index].completed = true;
    networkHistory[index].completedAt = new Date().toISOString();
    localStorage.setItem("networkHistory", JSON.stringify(networkHistory));
    
    // Sync with Firebase
    if (syncStatus === 'connected') {
      database.ref('networkHistory').set(networkHistory);
    }
    
    loadHistory();
    showNotif("âœ… Network data ditandai sebagai selesai!");
  }
}

// âœ… Mark Rekap Data as Completed
function markRekapCompleted(id) {
  let rekapList = JSON.parse(localStorage.getItem("rekapList")) || [];
  const itemIndex = rekapList.findIndex(item => item.id === id);
  if (itemIndex !== -1) {
    rekapList[itemIndex].completed = true;
    rekapList[itemIndex].completedAt = new Date().toISOString();
    localStorage.setItem("rekapList", JSON.stringify(rekapList));
    
    // Sync with Firebase
    if (syncStatus === 'connected') {
      database.ref('rekapList').set(rekapList);
    }
    
    loadRekapData();
    showNotif("âœ… Rekap log harian ditandai sebagai selesai!");
  }
}

// âœ… Mark Laporan as Completed
function markLaporanCompleted(id) {
  let laporanList = JSON.parse(localStorage.getItem("laporanList")) || [];
  const itemIndex = laporanList.findIndex(item => item.id === id);
  if (itemIndex !== -1) {
    laporanList[itemIndex].completed = true;
    laporanList[itemIndex].completedAt = new Date().toISOString();
    localStorage.setItem("laporanList", JSON.stringify(laporanList));
    
    // Sync with Firebase
    if (syncStatus === 'connected') {
      database.ref('laporanList').set(laporanList);
    }
    
    loadLaporanHistory();
    showNotif("âœ… Laporan harian ditandai sebagai selesai!");
  }
}

// ==================== GURU FUNCTIONS ====================

// ðŸ”‘ Login Guru
function loginGuru() {
  const username = document.getElementById('guruUsername').value.trim();
  const password = document.getElementById('guruPassword').value.trim();

  if (!username || !password) {
    showNotif("âš ï¸ Isi username dan password!", "error");
    return;
  }

  // Default guru credentials (dalam aplikasi nyata, ini harus di server)
  if (username === "guru" && password === "guru123") {
    const guruUser = {
      username: username,
      name: "Pembimbing Magang",
      role: "guru",
      lastUpdated: new Date().toISOString()
    };
    localStorage.setItem("activeGuru", JSON.stringify(guruUser));
    
    // Sync with Firebase
    if (syncStatus === 'connected') {
      syncGuruData(guruUser);
    }
    
    showNotif("âœ… Login guru berhasil!");
    loadGuruDashboard();
    switchPage("pageGuruLogin","pageGuruDashboard");
  } else {
    showNotif("âš ï¸ Username atau password guru salah!", "error");
  }
}

// ðŸšª Logout Guru
function logoutGuru() {
  if (confirm("Apakah Anda yakin ingin logout?")) {
    localStorage.removeItem("activeGuru");
    showNotif("âœ… Anda telah logout!");
    switchPage("pageGuruDashboard", "page1");
  }
}

// ðŸ“Š Load Guru Dashboard
function loadGuruDashboard() {
  const activeGuru = JSON.parse(localStorage.getItem("activeGuru"));
  if (activeGuru) {
    document.getElementById("guruName").textContent = activeGuru.name;
  }

  // Load students data
  loadStudentsList();
  loadTasksList();
  updateGuruStats();
}

// ðŸ“Š Load Students List
function loadStudentsList() {
  const users = JSON.parse(localStorage.getItem("users")) || [];
  const studentsList = document.getElementById("studentsList");
  const studentFilter = document.getElementById("studentFilter");

  // Clear existing content
  studentsList.innerHTML = "";
  studentFilter.innerHTML = '<option value="">Semua Siswa</option>';

  if (users.length === 0) {
    studentsList.innerHTML = '<p class="text-center text-gray-500 py-8">Belum ada siswa terdaftar</p>';
    return;
  }

  // Populate filter dropdown
  users.forEach(user => {
    const option = document.createElement('option');
    option.value = user.username;
    option.textContent = user.name || user.username;
    studentFilter.appendChild(option);
  });

  // Create student cards
  users.forEach(user => {
    const studentCard = createStudentCard(user);
    studentsList.appendChild(studentCard);
  });
}

// ðŸŽ¯ Create Student Card
function createStudentCard(user) {
  const card = document.createElement('div');
  card.className = 'student-card';
  card.dataset.username = user.username;

  // Calculate student progress
  const progress = calculateStudentProgress(user.username);

  card.innerHTML = `
  <div class="flex items-center justify-between">
  <div class="flex items-center gap-4">
  <div class="w-12 h-12 bg-gradient-primary rounded-full p-2">
   ${user.profilePhoto ?
  `<img src="${user.profilePhoto}" class="w-full h-full rounded-full object-cover">` :
  `<i class="fas fa-user text-white text-lg flex items-center justify-center h-full"></i>`
  }
  </div>
  <div>
  <h4 class="text-lg font-semibold text-gray-800">${user.name || user.username}</h4>
  <p class="text-sm text-gray-600">${user.email || user.asal}</p>
  <p class="text-sm text-gray-600">${user.lokasi || 'Belum ada lokasi'}</p>
  </div>
  </div>
  <div class="text-right">
  <div class="text-2xl font-bold text-primary mb-1">${progress}%</div>
  <div class="progress-bar w-32">
  <div class="progress-fill" style="width: ${progress}%"></div>
  </div>
  </div>
  </div>
  <div class="mt-4 flex justify-between items-center">
  <div class="flex gap-2">
  <span class="task-status completed">
  <i class="fas fa-check-circle"></i>
   ${getTaskCount(user.username, 'completed')}
  </span>
  <span class="task-status pending">
  <i class="fas fa-clock"></i>
   ${getTaskCount(user.username, 'pending')}
  </span>
  </div>
  <button onclick="viewStudentDetail('${user.username}')" class="btn btn-primary btn-sm">
  <i class="fas fa-eye"></i>
  Lihat Detail
  </button>
  </div>
  </div>
  `;

  return card;
}

// ðŸ“Š Calculate Student Progress
function calculateStudentProgress(username) {
  const totalTasks = 6; // Total task categories
  let completedTasks = 0;

  // Check each task category
  const absenList = JSON.parse(localStorage.getItem("absenList")) || [];
  const monitoringList = JSON.parse(localStorage.getItem("monitoringList")) || [];
  const networkHistory = JSON.parse(localStorage.getItem("networkHistory")) || [];
  const rekapList = JSON.parse(localStorage.getItem("rekapList")) || [];
  const laporanList = JSON.parse(localStorage.getItem("laporanList")) || [];
  const websiteScreenshots = JSON.parse(localStorage.getItem("websiteScreenshots")) || [];

  // For simplicity, we'll check if there's any data in each category
  if (absenList.length > 0) completedTasks++;
  if (monitoringList.length > 0) completedTasks++;
  if (networkHistory.length > 0) completedTasks++;
  if (rekapList.length > 0) completedTasks++;
  if (laporanList.length > 0) completedTasks++;
  if (websiteScreenshots.length > 0) completedTasks++;

  return Math.round((completedTasks / totalTasks) * 100);
}

// ðŸ“Š Get Task Count
function getTaskCount(username, type) {
  // This is a simplified version - in real app, you'd filter by username
  const absenList = JSON.parse(localStorage.getItem("absenList")) || [];
  const monitoringList = JSON.parse(localStorage.getItem("monitoringList")) || [];
  const networkHistory = JSON.parse(localStorage.getItem("networkHistory")) || [];
  const rekapList = JSON.parse(localStorage.getItem("rekapList")) || [];
  const laporanList = JSON.parse(localStorage.getItem("laporanList")) || [];
  const websiteScreenshots = JSON.parse(localStorage.getItem("websiteScreenshots")) || [];

  const totalTasks = absenList.length + monitoringList.length + networkHistory.length +
  rekapList.length + laporanList.length + websiteScreenshots.length;

  if (type === 'completed') {
    return totalTasks; // Simplified - all tasks considered completed
  } else {
    return 0; // Simplified - no pending tasks
  }
}

// ðŸ“Š Update Guru Stats
function updateGuruStats() {
  const users = JSON.parse(localStorage.getItem("users")) || [];
  const absenList = JSON.parse(localStorage.getItem("absenList")) || [];
  const monitoringList = JSON.parse(localStorage.getItem("monitoringList")) || [];
  const networkHistory = JSON.parse(localStorage.getItem("networkHistory")) || [];
  const rekapList = JSON.parse(localStorage.getItem("rekapList")) || [];
  const laporanList = JSON.parse(localStorage.getItem("laporanList")) || [];
  const websiteScreenshots = JSON.parse(localStorage.getItem("websiteScreenshots")) || [];
  const tasks = JSON.parse(localStorage.getItem("tasks")) || [];

  const totalTasks = absenList.length + monitoringList.length + networkHistory.length +
  rekapList.length + laporanList.length + websiteScreenshots.length + tasks.length;

  document.getElementById("totalStudents").textContent = users.length;
  document.getElementById("totalTasks").textContent = totalTasks;
  document.getElementById("pendingTasks").textContent = "0"; // Simplified

  // Calculate average completion rate
  let totalProgress = 0;
  users.forEach(user => {
    totalProgress += calculateStudentProgress(user.username);
  });
  const avgProgress = users.length > 0 ? Math.round(totalProgress / users.length) : 0;
  document.getElementById("completionRate").textContent = avgProgress + "%";
}

// ðŸ‘ï¸ View Student Detail
function viewStudentDetail(username) {
  currentViewingStudent = username;
  const users = JSON.parse(localStorage.getItem("users")) || [];
  const user = users.find(u => u.username === username);

  if (!user) {
    showNotif("âš ï¸ Siswa tidak ditemukan!", "error");
    return;
  }

  // Update student detail page
  document.getElementById("studentDetailName").textContent = user.name || user.username;
  document.getElementById("studentDetailEmail").textContent = user.email || "-";
  document.getElementById("studentDetailSchool").textContent = user.asal;
  document.getElementById("studentDetailLocation").textContent = user.lokasi || "Belum diisi";
  document.getElementById("studentDetailJurusan").textContent = user.jurusan || "Belum diisi";

  // Update photo
  const photoContainer = document.getElementById("studentDetailPhoto");
  if (user.profilePhoto) {
    photoContainer.innerHTML = `<img src="${user.profilePhoto}" class="profile-photo" onclick="viewImage('${user.profilePhoto}')" />`;
  } else {
    photoContainer.innerHTML = `
    <div class="profile-photo-placeholder">
    <i class="fas fa-user text-gray-400 text-3xl"></i>
    </div>
    `;
  }

  // Update progress
  const progress = calculateStudentProgress(username);
  document.getElementById("studentProgress").textContent = progress + "%";
  document.getElementById("studentProgressBar").style.width = progress + "%";

  // Update task counts
  updateTaskCounts(username);
  
  // Load activity timeline
  loadActivityTimeline(username);

  // Switch to student detail page
  switchPage("pageGuruDashboard", "pageStudentDetail");
}

// ðŸ“Š Load Activity Timeline
function loadActivityTimeline(username) {
  const timeline = document.getElementById("activityTimeline");
  timeline.innerHTML = "";
  
  // Get all activities for this student
  const activities = [];
  
  // Get absen data
  const absenList = JSON.parse(localStorage.getItem("absenList")) || [];
  absenList.forEach(item => {
    activities.push({
      type: "absen",
      title: "Data Hadir",
      date: item.tanggal,
      description: `Status: ${item.status}`
    });
  });
  
  // Get monitoring data
  const monitoringList = JSON.parse(localStorage.getItem("monitoringList")) || [];
  monitoringList.forEach(item => {
    activities.push({
      type: "monitoring",
      title: "Monitoring Website",
      date: item.tanggal,
      description: `Judul: ${item.judul}, Koleksi: ${item.koleksi}`
    });
  });
  
  // Get network data
  const networkHistory = JSON.parse(localStorage.getItem("networkHistory")) || [];
  networkHistory.forEach((item, index) => {
    activities.push({
      type: "network",
      title: "Monitoring Network",
      date: item.date,
      description: `Upload screenshot jaringan`
    });
  });
  
  // Get rekap data
  const rekapList = JSON.parse(localStorage.getItem("rekapList")) || [];
  rekapList.forEach(item => {
    activities.push({
      type: "rekap",
      title: "Rekap Log Harian",
      date: item.tanggal,
      description: `Kegiatan: ${item.kegiatan}`
    });
  });
  
  // Get laporan data
  const laporanList = JSON.parse(localStorage.getItem("laporanList")) || [];
  laporanList.forEach(item => {
    activities.push({
      type: "laporan",
      title: "Laporan Harian",
      date: item.tanggal,
      description: `Kegiatan: ${item.namaKegiatan}`
    });
  });
  
  // Sort by date (newest first)
  activities.sort((a, b) => new Date(b.date) - new Date(a.date));
  
  // Take only the 5 most recent activities
  const recentActivities = activities.slice(0, 5);
  
  // Create timeline items
  recentActivities.forEach(activity => {
    const timelineItem = document.createElement("div");
    timelineItem.className = "timeline-item";
    
    const iconClass = activity.type === "absen" ? "fa-calendar-check text-green-500" :
                     activity.type === "monitoring" ? "fa-globe text-blue-500" :
                     activity.type === "network" ? "fa-network-wired text-yellow-500" :
                     activity.type === "rekap" ? "fa-clipboard-list text-purple-500" :
                     "fa-file-alt text-red-500";
    
    timelineItem.innerHTML = `
    <div class="timeline-content">
    <h4 class="timeline-title">${activity.title}</h4>
    <p class="text-gray-600">${activity.description}</p>
    <p class="timeline-date">${formatDate(activity.date)}</p>
    </div>
    `;
    
    timeline.appendChild(timelineItem);
  });
  
  if (activities.length === 0) {
    timeline.innerHTML = '<p class="text-center text-gray-500 py-4">Belum ada aktivitas</p>';
  }
}

// ðŸ“Š Update Task Counts
function updateTaskCounts(username) {
  const absenList = JSON.parse(localStorage.getItem("absenList")) || [];
  const monitoringList = JSON.parse(localStorage.getItem("monitoringList")) || [];
  const networkHistory = JSON.parse(localStorage.getItem("networkHistory")) || [];
  const rekapList = JSON.parse(localStorage.getItem("rekapList")) || [];
  const laporanList = JSON.parse(localStorage.getItem("laporanList")) || [];
  const websiteScreenshots = JSON.parse(localStorage.getItem("websiteScreenshots")) || [];

  document.getElementById("absenCount").textContent = absenList.length;
  document.getElementById("monitoringCount").textContent = monitoringList.length;
  document.getElementById("networkCount").textContent = networkHistory.length;
  document.getElementById("rekapCount").textContent = rekapList.length;
  document.getElementById("laporanCount").textContent = laporanList.length;
  document.getElementById("screenshotCount").textContent = websiteScreenshots.length;

  // Update status badges
  updateTaskStatus('absenStatus', absenList.length > 0);
  updateTaskStatus('monitoringStatus', monitoringList.length > 0);
  updateTaskStatus('networkStatus', networkHistory.length > 0);
  updateTaskStatus('rekapStatus', rekapList.length > 0);
  updateTaskStatus('laporanStatus', laporanList.length > 0);
  updateTaskStatus('screenshotStatus', websiteScreenshots.length > 0);
  
  // Update progress bars
  const totalTasks = 6;
  const completedTasks = [
    absenList.length > 0 ? 1 : 0,
    monitoringList.length > 0 ? 1 : 0,
    networkHistory.length > 0 ? 1 : 0,
    rekapList.length > 0 ? 1 : 0,
    laporanList.length > 0 ? 1 : 0,
    websiteScreenshots.length > 0 ? 1 : 0
  ].reduce((sum, val) => sum + val, 0);
  
  const progressPercent = Math.round((completedTasks / totalTasks) * 100);
  
  document.getElementById("absenProgress").style.width = `${absenList.length > 0 ? 100 : 0}%`;
  document.getElementById("monitoringProgress").style.width = `${monitoringList.length > 0 ? 100 : 0}%`;
  document.getElementById("networkProgress").style.width = `${networkHistory.length > 0 ? 100 : 0}%`;
  document.getElementById("rekapProgress").style.width = `${rekapList.length > 0 ? 100 : 0}%`;
  document.getElementById("laporanProgress").style.width = `${laporanList.length > 0 ? 100 : 0}%`;
  document.getElementById("screenshotProgress").style.width = `${websiteScreenshots.length > 0 ? 100 : 0}%`;
}

// ðŸ·ï¸ Update Task Status
function updateTaskStatus(elementId, hasData) {
  const element = document.getElementById(elementId);
  if (hasData) {
    element.className = 'task-status completed';
    element.innerHTML = '<i class="fas fa-check-circle"></i> Selesai';
  } else {
    element.className = 'task-status pending';
    element.innerHTML = '<i class="fas fa-clock"></i> Pending';
  }
}

// ðŸ‘ï¸ View Student Task
function viewStudentTask(taskType) {
  // This would open a detailed view of the specific task
  // For now, we'll just show a notification
  showNotif(`ðŸ“‹ Melihat detail tugas: ${taskType}`);
}

// ðŸ“¤ Export Student Data
function exportStudentData(format) {
  if (!currentViewingStudent) return;

  const users = JSON.parse(localStorage.getItem("users")) || [];
  const user = users.find(u => u.username === currentViewingStudent);

  if (!user) return;

  const progress = calculateStudentProgress(currentViewingStudent);
  
  if (format === 'pdf') {
    // For PDF export, we would need a library like jsPDF
    // For now, we'll create a simple text export
    const exportData = `
    LAPORAN PROGRESS MAGANG
    ========================
    Nama: ${user.name || user.username}
    Email: ${user.email || '-'}
    Sekolah: ${user.asal}
    Lokasi: ${user.lokasi || 'Belum diisi'}
    Jurusan: ${user.jurusan || 'Belum diisi'}
    Progress: ${progress}%

    Tanggal Export: ${new Date().toLocaleString()}
    `;

    // Create download link
    const blob = new Blob([exportData], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `progress_${currentViewingStudent}.txt`;
    a.click();
    window.URL.revokeObjectURL(url);

    showNotif("âœ… Data berhasil diexport sebagai teks!");
  } else if (format === 'excel') {
    // For Excel export, we would need a library like SheetJS
    // For now, we'll create a simple CSV export
    const csvData = `Nama,Email,Sekolah,Lokasi,Jurusan,Progress,Tanggal Export\n${user.name || user.username},${user.email || '-'},${user.asal},${user.lokasi || 'Belum diisi'},${user.jurusan || 'Belum diisi'},${progress}%,${new Date().toLocaleString()}`;
    
    // Create download link
    const blob = new Blob([csvData], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `progress_${currentViewingStudent}.csv`;
    a.click();
    window.URL.revokeObjectURL(url);

    showNotif("âœ… Data berhasil diexport sebagai CSV!");
  } else if (format === 'json') {
    // Create JSON export
    const jsonData = {
      name: user.name || user.username,
      email: user.email || '-',
      school: user.asal,
      location: user.lokasi || 'Belum diisi',
      major: user.jurusan || 'Belum diisi',
      progress: progress,
      exportDate: new Date().toISOString()
    };
    
    // Create download link
    const blob = new Blob([JSON.stringify(jsonData, null, 2)], { type: 'application/json' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `progress_${currentViewingStudent}.json`;
    a.click();
    window.URL.revokeObjectURL(url);

    showNotif("âœ… Data berhasil diexport sebagai JSON!");
  }
}

// ðŸ’¬ Open Feedback Modal
function openFeedbackModal() {
  if (!currentViewingStudent) return;
  
  const users = JSON.parse(localStorage.getItem("users")) || [];
  const user = users.find(u => u.username === currentViewingStudent);
  
  if (!user) return;
  
  document.getElementById("feedbackStudentName").textContent = user.name || user.username;
  document.getElementById("feedbackModal").classList.add("active");
}

// âŒ Close Feedback Modal
function closeFeedbackModal() {
  document.getElementById("feedbackModal").classList.remove("active");
  document.getElementById("feedbackForm").reset();
}

// ðŸ’¬ Submit Feedback
function submitFeedback() {
  const title = document.getElementById("feedbackTitle").value.trim();
  const message = document.getElementById("feedbackMessage").value.trim();
  const type = document.getElementById("feedbackType").value;
  
  if (!title || !message) {
    showNotif("âš ï¸ Judul dan pesan feedback harus diisi!", "error");
    return;
  }
  
  // Save feedback to localStorage
  const feedbacks = JSON.parse(localStorage.getItem("feedbacks")) || [];
  const newFeedback = {
    id: Date.now(),
    studentUsername: currentViewingStudent,
    title,
    message,
    type,
    createdAt: new Date().toISOString()
  };
  
  feedbacks.push(newFeedback);
  localStorage.setItem("feedbacks", JSON.stringify(feedbacks));
  
  // Sync with Firebase
  if (syncStatus === 'connected') {
    database.ref('feedbacks').set(feedbacks);
  }
  
  // Add notification for the student
  addNotification(
    currentViewingStudent,
    title,
    message,
    type
  );
  
  closeFeedbackModal();
  showNotif("âœ… Feedback berhasil dikirim!");
}

// ðŸ”” Toggle Notification Panel
function toggleNotificationPanel() {
  const panel = document.getElementById("notificationPanel");
  panel.classList.toggle("active");
  
  // Mark all notifications as read when opening the panel
  if (panel.classList.contains("active")) {
    markAllNotificationsAsRead();
  }
}

// ðŸ”” Add Notification
function addNotification(username, title, message, type = "info") {
  const notification = {
    id: Date.now(),
    username,
    title,
    message,
    type,
    createdAt: new Date().toISOString(),
    read: false
  };
  
  notifications.push(notification);
  localStorage.setItem("notifications", JSON.stringify(notifications));
  
  // Update notification badge
  updateNotificationBadge();
  
  // Sync with Firebase
  if (syncStatus === 'connected') {
    database.ref(`notifications/${username}`).set(notifications);
  }
  
  // If the user is currently logged in, show a notification
  const activeUser = JSON.parse(localStorage.getItem("activeUser"));
  if (activeUser && (activeUser.username === username || activeUser.email === username)) {
    showNotif(`ðŸ”” ${title}`, type);
  }
}

// ðŸ”” Load Notifications
function loadNotifications() {
  const activeUser = JSON.parse(localStorage.getItem("activeUser"));
  if (!activeUser) return;
  
  notifications = JSON.parse(localStorage.getItem("notifications")) || [];
  const userNotifications = notifications.filter(n => 
    n.username === activeUser.username || n.username === activeUser.email
  );
  
  const notificationList = document.getElementById("notificationList");
  notificationList.innerHTML = "";
  
  if (userNotifications.length === 0) {
    notificationList.innerHTML = '<div class="p-4 text-center text-gray-500">Tidak ada notifikasi</div>';
    return;
  }
  
  // Sort by date (newest first)
  userNotifications.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
  
  userNotifications.forEach(notification => {
    const notificationItem = document.createElement("div");
    notificationItem.className = `notification-item ${notification.read ? "" : "unread"}`;
    
    const iconClass = notification.type === "success" ? "fa-check-circle text-green-500" :
                     notification.type === "warning" ? "fa-exclamation-triangle text-yellow-500" :
                     notification.type === "error" ? "fa-exclamation-circle text-red-500" :
                     "fa-info-circle text-blue-500";
    
    notificationItem.innerHTML = `
    <div class="flex items-start gap-3">
    <i class="fas ${iconClass} mt-1"></i>
    <div class="flex-1">
    <h4 class="notification-title">${notification.title}</h4>
    <p class="notification-message">${notification.message}</p>
    <p class="notification-time">${formatNotificationTime(notification.createdAt)}</p>
    </div>
    <button onclick="deleteNotification(${notification.id})" class="text-gray-400 hover:text-red-500">
    <i class="fas fa-times"></i>
    </button>
    </div>
    `;
    
    notificationList.appendChild(notificationItem);
  });
  
  // Update notification badge
  updateNotificationBadge();
}

// ðŸ”” Update Notification Badge
function updateNotificationBadge() {
  const activeUser = JSON.parse(localStorage.getItem("activeUser"));
  if (!activeUser) return;
  
  const unreadCount = notifications.filter(n => 
    (n.username === activeUser.username || n.username === activeUser.email) && !n.read
  ).length;
  
  const badge = document.getElementById("notificationBadge");
  if (unreadCount > 0) {
    badge.textContent = unreadCount;
    badge.style.display = "flex";
  } else {
    badge.style.display = "none";
  }
}

// ðŸ”” Mark All Notifications as Read
function markAllNotificationsAsRead() {
  const activeUser = JSON.parse(localStorage.getItem("activeUser"));
  if (!activeUser) return;
  
  notifications.forEach(notification => {
    if (notification.username === activeUser.username || notification.username === activeUser.email) {
      notification.read = true;
    }
  });
  
  localStorage.setItem("notifications", JSON.stringify(notifications));
  updateNotificationBadge();
  
  // Sync with Firebase
  if (syncStatus === 'connected') {
    database.ref(`notifications/${activeUser.username || activeUser.email}`).set(notifications);
  }
}

// ðŸ”” Delete Notification
function deleteNotification(id) {
  notifications = notifications.filter(n => n.id !== id);
  localStorage.setItem("notifications", JSON.stringify(notifications));
  
  // Sync with Firebase
  if (syncStatus === 'connected') {
    const activeUser = JSON.parse(localStorage.getItem("activeUser"));
    if (activeUser) {
      database.ref(`notifications/${activeUser.username || activeUser.email}`).set(notifications);
    }
  }
  
  loadNotifications();
}

// ðŸ”” Clear All Notifications
function clearAllNotifications() {
  const activeUser = JSON.parse(localStorage.getItem("activeUser"));
  if (!activeUser) return;
  
  if (confirm("Apakah Anda yakin ingin menghapus semua notifikasi?")) {
    notifications = notifications.filter(n => 
      n.username !== activeUser.username && n.username !== activeUser.email
    );
    localStorage.setItem("notifications", JSON.stringify(notifications));
    
    // Sync with Firebase
    if (syncStatus === 'connected') {
      database.ref(`notifications/${activeUser.username || activeUser.email}`).set(notifications);
    }
    
    loadNotifications();
  }
}

// ðŸ• Format Notification Time
function formatNotificationTime(dateString) {
  const date = new Date(dateString);
  const now = new Date();
  const diffMs = now - date;
  const diffMins = Math.floor(diffMs / 60000);
  const diffHours = Math.floor(diffMs / 3600000);
  const diffDays = Math.floor(diffMs / 86400000);
  
  if (diffMins < 1) {
    return "Baru saja";
  } else if (diffMins < 60) {
    return `${diffMins} menit yang lalu`;
  } else if (diffHours < 24) {
    return `${diffHours} jam yang lalu`;
  } else if (diffDays < 7) {
    return `${diffDays} hari yang lalu`;
  } else {
    return date.toLocaleDateString('id-ID');
  }
}

// ðŸ” Filter Students
function filterStudents() {
  const filterValue = document.getElementById("studentFilter").value;
  const studentCards = document.querySelectorAll(".student-card");

  studentCards.forEach(card => {
    if (filterValue === "" || card.dataset.username === filterValue) {
      card.style.display = "block";
    } else {
      card.style.display = "none";
    }
  });
}

// ðŸ” Filter Tasks
function filterTasks() {
  const filterValue = document.getElementById("taskFilter").value;
  showNotif(`ðŸ” Filter tugas: ${filterValue || 'Semua'}`);
}

// ðŸ”„ Refresh Data
function refreshData() {
  loadStudentsList();
  loadTasksList();
  updateGuruStats();
  showNotif("âœ… Data berhasil diperbarui!");
}

// ðŸ“Š Load Progress Chart
function loadProgressChart() {
  const ctx = document.getElementById('progressChart');
  if (!ctx) return;
  
  const users = JSON.parse(localStorage.getItem("users")) || [];
  
  // Prepare data for chart
  const labels = [];
  const data = [];
  
  users.forEach(user => {
    labels.push(user.name || user.username);
    data.push(calculateStudentProgress(user.username));
  });
  
  // Destroy existing chart if it exists
  if (progressChart) {
    progressChart.destroy();
  }
  
  // Create new chart
  progressChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Progress (%)',
        data: data,
        backgroundColor: 'rgba(102, 126, 234, 0.5)',
        borderColor: 'rgba(102, 126, 234, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true,
          max: 100,
          ticks: {
            callback: function(value) {
              return value + '%';
            }
          }
        }
      },
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              return context.parsed.y + '%';
            }
          }
        }
      }
    }
  });
}

// ðŸ“Š Load Student Progress Chart
function loadStudentProgressChart() {
  const ctx = document.getElementById('studentProgressChart');
  if (!ctx) return;
  
  const activeUser = JSON.parse(localStorage.getItem("activeUser"));
  if (!activeUser) return;
  
  // Get task data for the current user
  const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
  const userTasks = tasks.filter(t => t.assignTo === activeUser.username || t.assignTo === activeUser.email);
  
  // Prepare data for chart
  const labels = [];
  const completedData = [];
  const pendingData = [];
  
  // Get data for each task category
  const absenList = JSON.parse(localStorage.getItem("absenList")) || [];
  const monitoringList = JSON.parse(localStorage.getItem("monitoringList")) || [];
  const networkHistory = JSON.parse(localStorage.getItem("networkHistory")) || [];
  const rekapList = JSON.parse(localStorage.getItem("rekapList")) || [];
  const laporanList = JSON.parse(localStorage.getItem("laporanList")) || [];
  const websiteScreenshots = JSON.parse(localStorage.getItem("websiteScreenshots")) || [];
  
  labels.push('Data Hadir', 'Monitoring Website', 'Monitoring Network', 'Rekap Log', 'Laporan Harian', 'Screenshot');
  completedData.push(
    absenList.length > 0 ? 1 : 0,
    monitoringList.length > 0 ? 1 : 0,
    networkHistory.length > 0 ? 1 : 0,
    rekapList.length > 0 ? 1 : 0,
    laporanList.length > 0 ? 1 : 0,
    websiteScreenshots.length > 0 ? 1 : 0
  );
  pendingData.push(
    absenList.length > 0 ? 0 : 1,
    monitoringList.length > 0 ? 0 : 1,
    networkHistory.length > 0 ? 0 : 1,
    rekapList.length > 0 ? 0 : 1,
    laporanList.length > 0 ? 0 : 1,
    websiteScreenshots.length > 0 ? 0 : 1
  );
  
  // Add task data
  userTasks.forEach(task => {
    labels.push(task.title);
    completedData.push(task.status === 'completed' ? 1 : 0);
    pendingData.push(task.status === 'completed' ? 0 : 1);
  });
  
  // Destroy existing chart if it exists
  if (studentProgressChart) {
    studentProgressChart.destroy();
  }
  
  // Create new chart
  studentProgressChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [
        {
          label: 'Selesai',
          data: completedData,
          backgroundColor: 'rgba(34, 197, 94, 0.5)',
          borderColor: 'rgba(34, 197, 94, 1)',
          borderWidth: 1
        },
        {
          label: 'Pending',
          data: pendingData,
          backgroundColor: 'rgba(245, 158, 11, 0.5)',
          borderColor: 'rgba(245, 158, 11, 1)',
          borderWidth: 1
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true,
          max: 1,
          ticks: {
            callback: function(value) {
              return value === 1 ? 'Selesai' : 'Pending';
            }
          }
        }
      },
      plugins: {
        legend: {
          position: 'top'
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              return context.dataset.label + ': ' + (context.parsed.y === 1 ? 'Selesai' : 'Pending');
            }
          }
        }
      }
    }
  });
}

// Cek user yang sudah login saat halaman dimuat
window.onload = function() {
  // Initialize Firebase connection
  initializeFirebaseConnection();
  
  tampilAbsen();
  loadRekapData();
  loadLaporanHistory();
  loadMonitoringHistory();
  loadScreenshotHistory();
  loadHistory();
  
  const activeUser = JSON.parse(localStorage.getItem("activeUser"));
  if (activeUser) {
    displayUserData(activeUser);
    
    // Check current page and load appropriate data
    const currentPage = getCurrentPage();
    if (currentPage === 'page2') {
      loadStudentTasks();
      loadStudentProgressChart();
    } else if (currentPage === 'page2Menu') {
      loadMenuTasks();
    }
    
    // Always update task counts
    updateTaskCount();
    updateMenuTaskCount();
    
    // Load notifications
    loadNotifications();
  }
  
  const activeGuru = JSON.parse(localStorage.getItem("activeGuru"));
  if (activeGuru) {
    loadGuruDashboard();
    loadProgressChart();
  }
};
</script>
</body>
</html>

